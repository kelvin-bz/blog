<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="light">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Outlier Pattern - Handling Viral Posts in Social Media Platforms" />
<meta property="og:locale" content="en" />
<meta name="description" content="Outlier Pattern" />
<meta property="og:description" content="Outlier Pattern" />
<link rel="canonical" href="http://localhost:4000/posts/outlier-pattern/" />
<meta property="og:url" content="http://localhost:4000/posts/outlier-pattern/" />
<meta property="og:site_name" content="KelvinBz" />
<meta property="og:image" content="http://localhost:4000/assets/images/cute-cat.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-25T07:00:00+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/cute-cat.png" />
<meta property="twitter:title" content="Outlier Pattern - Handling Viral Posts in Social Media Platforms" />
<meta name="twitter:site" content="@kelvin_bzz" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-08-04T17:59:23+07:00","datePublished":"2024-07-25T07:00:00+07:00","description":"Outlier Pattern","headline":"Outlier Pattern - Handling Viral Posts in Social Media Platforms","image":"http://localhost:4000/assets/images/cute-cat.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/outlier-pattern/"},"url":"http://localhost:4000/posts/outlier-pattern/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Outlier Pattern - Handling Viral Posts in Social Media Platforms | KelvinBz
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="KelvinBz">
<meta name="application-name" content="KelvinBz">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/15279486?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">KelvinBz</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">My personal blog about Life, Technology, and Everything in Between.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/kelvin-bz"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/kelvin_bzz"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['huycuongbuicong','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Outlier Pattern - Handling Viral Posts in Social Media Platforms</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Outlier Pattern - Handling Viral Posts in Social Media Platforms</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1721865600"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jul 25, 2024
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1722769163"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug  4, 2024
</time>

        </span>
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/images/cute-cat.png" class="popup img-link preview-img shimmer"><img src="/assets/images/cute-cat.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/kelvin-bz">kelvinBz</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1097 words"
>
  <em>6 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="outlier-pattern"><span class="me-2">Outlier Pattern</span><a href="#outlier-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Imagine you’re building a social media platform where users can create posts, and others can like, comment, or share those posts. In most cases, the number of interactions per post is manageable. However, viral posts can accumulate massive amounts of likes, comments, and shares, potentially exceeding the document size limit or impacting query performance.</p>

<pre><code class="language-mermaid">graph TD
    subgraph originalData["📁 Original Data Structure"]
        post["🐈 Post: Cute Cat Video"]
        likes1["👍 Likes: user00, user01, ..., user999"]
    end
    post --&gt; likes1
</code></pre>

<h2 id="applying-the-outlier-pattern"><span class="me-2">Applying the Outlier Pattern</span><a href="#applying-the-outlier-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><strong>Original Data Structure:</strong></p>

<p>Most posts have a reasonable number of interactions stored directly within the post document.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">507f1f77bcf86cd799439011</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Check out my new blog post!</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">likes</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">user00</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">user01</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">user02</span><span class="dl">"</span><span class="p">],</span> 
  <span class="dl">"</span><span class="s2">comments</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user03</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Great post!</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user04</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Thanks for sharing!</span><span class="dl">"</span> <span class="p">}</span>
  <span class="p">],</span> 
  <span class="dl">"</span><span class="s2">shares</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">user05</span><span class="dl">"</span><span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Outlier Post:</strong></p>

<p>When a post goes viral and accumulates a large number of interactions, you create an “overflow” document to store the excess data.</p>

<pre><code class="language-mermaid">graph TD
    subgraph originalData["📁 Original Data Structure"]
        post["fa:fa-file Post: Cute Cat Video"]
        likes1["fa:fa-thumbs-up Likes: user00, user01, ..., user999"]
        hasExtras["⚠️ Has Overflow: true"]
        style post fill:#f9,stroke:#333,stroke-width:4px
        style likes1 fill:#bbf,stroke:#333,stroke-width:2px
        style hasExtras fill:#faa,stroke:#333,stroke-width:2px
    end
    post --&gt; |contains|likes1
    post --&gt; |indicates overflow|hasExtras

    subgraph overflowData["📁 Overflow Data"]
        postID["fa:fa-id-card Post ID: 507f191e810c19729de860ea"]
        likes2["fa:fa-thumbs-up Overflow Likes: user1000, user1001, ..."]
        style postID fill:#f9,stroke:#333,stroke-width:4px
        style likes2 fill:#bbf,stroke:#333,stroke-width:2px
    end
    postID --&gt; |links to|likes2
</code></pre>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1">// Main post document</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">507f191e810c19729de860ea</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">This cute cat video is going viral!</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">likes</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">user00</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">user01</span><span class="dl">"</span><span class="p">,</span> <span class="p">...,</span> <span class="dl">"</span><span class="s2">user999</span><span class="dl">"</span><span class="p">],</span>
  <span class="dl">"</span><span class="s2">has_overflow</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="c1">// Overflow document</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">507f191e810c19729de860eb</span><span class="dl">"</span><span class="p">),</span> 
  <span class="dl">"</span><span class="s2">post_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">507f191e810c19729de860ea</span><span class="dl">"</span><span class="p">),</span> 
  <span class="dl">"</span><span class="s2">likes</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">user1000</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">user1001</span><span class="dl">"</span><span class="p">,</span> <span class="p">...],</span>
  <span class="dl">"</span><span class="s2">comments</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user1002</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Adorable!</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user1003</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Made my day!</span><span class="dl">"</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<pre><code class="language-mermaid">classDiagram 
    Post "1" --&gt; "0..1" Overflow
    class Post{
        ObjectId _id
        String content
        String[] likes
        Object[] comments
        String[] shares
        Boolean has_overflow
    }
    class Overflow{
        ObjectId _id
        ObjectId post_id
        String[] likes
        Object[] comments
        String[] shares
    }
</code></pre>

<h2 id="benefits-of-the-outlier-pattern"><span class="me-2">Benefits of the Outlier Pattern</span><a href="#benefits-of-the-outlier-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><strong>Optimized Performance:</strong> Most posts are stored efficiently, leading to faster queries and better overall performance.</li>
  <li><strong>Scalability:</strong> Viral posts won’t hinder the system’s scalability.</li>
  <li><strong>Flexibility:</strong> You can easily add overflow documents for other types of interactions (comments, shares) as needed.</li>
</ul>

<h2 id="mongoose-schema"><span class="me-2">Mongoose Schema</span><a href="#mongoose-schema" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Here’s an improved Mongoose schema for implementing the Outlier Pattern:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongoose</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">commentSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="p">({</span>
  <span class="na">user</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="na">text</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="na">createdAt</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span> <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">overflowSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="p">({</span>
  <span class="na">post_id</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span>
    <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">ref</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Post</span><span class="dl">'</span>
  <span class="p">},</span>
  <span class="na">likes</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">],</span>
  <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">commentSchema</span><span class="p">],</span>
  <span class="na">shares</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">]</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">postSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="p">({</span>
  <span class="na">content</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">required</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="na">likes</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">],</span>
  <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">commentSchema</span><span class="p">],</span>
  <span class="na">shares</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">],</span>
  <span class="na">has_overflow</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span>
    <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">Post</span><span class="dl">'</span><span class="p">,</span> <span class="nx">postSchema</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Overflow</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">Overflow</span><span class="dl">'</span><span class="p">,</span> <span class="nx">overflowSchema</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Post</span><span class="p">,</span> <span class="nx">Overflow</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="retrieving-all-likes"><span class="me-2">Retrieving All Likes</span><a href="#retrieving-all-likes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>To retrieve all likes for a post, including any overflow likes:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="k">async</span> <span class="kd">function</span> <span class="nf">getAllLikes</span><span class="p">(</span><span class="nx">postId</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Post</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">postId</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Post not found</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">let</span> <span class="nx">allLikes</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">post</span><span class="p">.</span><span class="nx">likes</span><span class="p">];</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">has_overflow</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">overflow</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Overflow</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span> <span class="na">post_id</span><span class="p">:</span> <span class="nx">postId</span> <span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">overflow</span> <span class="o">&amp;&amp;</span> <span class="nx">overflow</span><span class="p">.</span><span class="nx">likes</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">allLikes</span> <span class="o">=</span> <span class="nx">allLikes</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="nx">overflow</span><span class="p">.</span><span class="nx">likes</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">allLikes</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="adding-a-new-like"><span class="me-2">Adding a New Like</span><a href="#adding-a-new-like" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Here’s an improved version of the function to add a new like to a post:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">LIKES_THRESHOLD</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">addLike</span><span class="p">(</span><span class="nx">postId</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">startSession</span><span class="p">();</span>
  <span class="nx">session</span><span class="p">.</span><span class="nf">startTransaction</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Post</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">postId</span><span class="p">).</span><span class="nf">session</span><span class="p">(</span><span class="nx">session</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Post not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">likes</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">has_overflow</span> <span class="o">&amp;&amp;</span> <span class="k">await</span> <span class="nf">userLikedInOverflow</span><span class="p">(</span><span class="nx">postId</span><span class="p">,</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">session</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">User has already liked this post</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">has_overflow</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nf">addToOverflow</span><span class="p">(</span><span class="nx">postId</span><span class="p">,</span> <span class="dl">'</span><span class="s1">likes</span><span class="dl">'</span><span class="p">,</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">session</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">likes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">LIKES_THRESHOLD</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nf">createOverflowDocument</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="dl">'</span><span class="s1">likes</span><span class="dl">'</span><span class="p">,</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">session</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">post</span><span class="p">.</span><span class="nx">likes</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
      <span class="k">await</span> <span class="nx">post</span><span class="p">.</span><span class="nf">save</span><span class="p">({</span> <span class="nx">session</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">commitTransaction</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">post</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">abortTransaction</span><span class="p">();</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">session</span><span class="p">.</span><span class="nf">endSession</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">userLikedInOverflow</span><span class="p">(</span><span class="nx">postId</span><span class="p">,</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">overflow</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Overflow</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span> <span class="na">post_id</span><span class="p">:</span> <span class="nx">postId</span> <span class="p">}).</span><span class="nf">session</span><span class="p">(</span><span class="nx">session</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">overflow</span> <span class="o">&amp;&amp;</span> <span class="nx">overflow</span><span class="p">.</span><span class="nx">likes</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">addToOverflow</span><span class="p">(</span><span class="nx">postId</span><span class="p">,</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">Overflow</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span>
    <span class="p">{</span> <span class="na">post_id</span><span class="p">:</span> <span class="nx">postId</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">$addToSet</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">field</span><span class="p">]:</span> <span class="nx">value</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">session</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">createOverflowDocument</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">has_overflow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">await</span> <span class="nx">Overflow</span><span class="p">.</span><span class="nf">create</span><span class="p">([{</span>
    <span class="na">post_id</span><span class="p">:</span> <span class="nx">post</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">field</span><span class="p">]:</span> <span class="p">[</span><span class="nx">value</span><span class="p">]</span>
  <span class="p">}],</span> <span class="p">{</span> <span class="nx">session</span> <span class="p">});</span>
  <span class="k">await</span> <span class="nx">post</span><span class="p">.</span><span class="nf">save</span><span class="p">({</span> <span class="nx">session</span> <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="more-use-cases"><span class="me-2">More Use Cases</span><a href="#more-use-cases" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><strong>Comments:</strong> Implement a similar approach for comments, creating overflow documents when the number of comments exceeds a certain threshold.</li>
  <li><strong>IOT sensor data:</strong> In IoT systems, most sensors might report data within expected ranges. However, during anomalies or critical events, certain sensors might generate an unusually high volume of data points. The Outlier Pattern can help manage these spikes without affecting the overall system performance.</li>
  <li><strong>Transaction History:</strong> In financial systems, most users might have a limited number of transactions. However, high-frequency traders or large corporations might generate a massive number of transactions. By separating these outliers into overflow documents, you can maintain optimal performance for the majority of users.</li>
</ul>

<h2 id="considerations"><span class="me-2">Considerations</span><a href="#considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><strong>Application Logic:</strong> Your application must handle checking for overflow documents and retrieving additional data when needed.</li>
  <li><strong>Data Consistency:</strong> Ensure consistency between the main post document and its overflow documents, especially during concurrent operations.</li>
  <li><strong>Query Complexity:</strong> Retrieving complete data may require multiple queries, potentially impacting read performance.</li>
  <li><strong>Indexing Strategy:</strong> Carefully consider indexing on both main and overflow collections to optimize query performance.</li>
  <li><strong>Handling Extreme Outliers</strong> : We can create multiple levels of overflow documents, shard the overflow collection.</li>
</ul>

<h2 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The Outlier Pattern efficiently handles viral posts or other data outliers by storing excess data in separate overflow documents. This approach ensures optimal performance for the majority of data while accommodating extreme outliers. By carefully managing the transition between main and overflow documents, you can maintain data consistency and query performance across the system.</p>

<h2 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-outlier-pattern">MongoDB Outlier Pattern</a></li>
</ul>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/system-design/">system design</a>,
          <a href="/categories/database-design/">database design</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/system-design/"
            class="post-tag no-text-decoration"
          >system design</a>
        
          <a
            href="/tags/mongodb/"
            class="post-tag no-text-decoration"
          >mongodb</a>
        
          <a
            href="/tags/database-design/"
            class="post-tag no-text-decoration"
          >database design</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Outlier%20Pattern%20-%20Handling%20Viral%20Posts%20in%20Social%20Media%20Platforms%20-%20KelvinBz&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Foutlier-pattern%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Outlier%20Pattern%20-%20Handling%20Viral%20Posts%20in%20Social%20Media%20Platforms%20-%20KelvinBz&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Foutlier-pattern%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Foutlier-pattern%2F&text=Outlier%20Pattern%20-%20Handling%20Viral%20Posts%20in%20Social%20Media%20Platforms%20-%20KelvinBz" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/password-hashing/">Hashing Passwords</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/expressjs-fundamental/">MERN - Express.js Fundamentals</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mongodb-fundamental/">MERN - MongoDB Fundamental</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/javascript-array-in-1-page/">JavaScript Array In 1 Page</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/blockchain-for-dummies/">Blockchain for dummies</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/database-design/">database design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mern/">mern</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/expressjs/">expressjs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/js/">js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/performance-optimization/">performance optimization</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/subset-pattern/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1722038400"
  data-df="ll"
  
>
  Jul 27, 2024
</time>

              <h4 class="pt-0 my-2">Subset Pattern: Optimizing MongoDB Working Sets</h4>
              <div class="text-muted">
                <p>Subset Pattern: Optimizing MongoDB Working Sets

Large documents with infrequently used data can cause working sets to exceed RAM, leading to performance issues.

The Subset Pattern addresses this ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/computed-pattern/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1721952000"
  data-df="ll"
  
>
  Jul 26, 2024
</time>

              <h4 class="pt-0 my-2">Computed Pattern - Efficiently Managing Data Computations</h4>
              <div class="text-muted">
                <p>Computed Pattern

The Computed Pattern involves precomputing values and storing the results to optimize performance and reduce CPU workload. This approach is particularly beneficial for application...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/attribute-pattern/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1721692800"
  data-df="ll"
  
>
  Jul 23, 2024
</time>

              <h4 class="pt-0 my-2">Attribute Pattern - Efficiently Querying Similar Fields</h4>
              <div class="text-muted">
                <p>The Attribute Pattern is especially useful in the following scenarios:


  When dealing with large documents that have numerous similar fields, but a subset of these fields shares common characteri...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/attribute-pattern/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Attribute Pattern - Efficiently Querying Similar Fields</p>
    </a>
  

  
    <a
      href="/posts/computed-pattern/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Computed Pattern - Efficiently Managing Data Computations</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <script src="/assets/mermaid.min.js"></script>
<script>
  document.querySelectorAll('.language-mermaid').forEach((block) => {
    block.style.display = 'none';
  });
  document.addEventListener('DOMContentLoaded', () => {
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    document.querySelectorAll('.language-mermaid').forEach((block) => {
      block.style.display = 'block';
    });
  });
</script>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/database-design/">database design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mern/">mern</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/expressjs/">expressjs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/js/">js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/performance-optimization/">performance optimization</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script>






<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

