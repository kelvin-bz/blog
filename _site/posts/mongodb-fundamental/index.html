<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="light">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="MERN - MongoDB Fundamental" />
<meta property="og:locale" content="en" />
<meta name="description" content="MongoDB Architecture" />
<meta property="og:description" content="MongoDB Architecture" />
<link rel="canonical" href="http://localhost:4000/posts/mongodb-fundamental/" />
<meta property="og:url" content="http://localhost:4000/posts/mongodb-fundamental/" />
<meta property="og:site_name" content="KelvinBz" />
<meta property="og:image" content="http://localhost:4000/assets/images/mongodb.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-20T07:00:00+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/mongodb.png" />
<meta property="twitter:title" content="MERN - MongoDB Fundamental" />
<meta name="twitter:site" content="@kelvin_bzz" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-23T13:41:02+07:00","datePublished":"2024-09-20T07:00:00+07:00","description":"MongoDB Architecture","headline":"MERN - MongoDB Fundamental","image":"http://localhost:4000/assets/images/mongodb.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/mongodb-fundamental/"},"url":"http://localhost:4000/posts/mongodb-fundamental/"}</script>
<!-- End Jekyll SEO tag -->


  <title>MERN - MongoDB Fundamental | KelvinBz
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="KelvinBz">
<meta name="application-name" content="KelvinBz">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/15279486?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">KelvinBz</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">My personal blog about Life, Technology, and Everything in Between.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/kelvin-bz"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/kelvin_bzz"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['huycuongbuicong','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>MERN - MongoDB Fundamental</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>MERN - MongoDB Fundamental</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1726790400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Sep 20, 2024
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1732344062"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Nov 23, 2024
</time>

        </span>
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/images/mongodb.png" class="popup img-link preview-img shimmer"><img src="/assets/images/mongodb.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/kelvin-bz">kelvinBz</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="9668 words"
>
  <em>53 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="mongodb-architecture"><span class="me-2">MongoDB Architecture</span><a href="#mongodb-architecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>MongoDB is a popular NoSQL database designed for high performance, high availability, and easy scalability. It stores data in flexible, JSON-like documents, making it easy to work with structured, semi-structured, and unstructured data.</p>

<ul>
  <li><strong>Database</strong>: A container for collections.</li>
  <li><strong>Collection</strong>: A group of MongoDB documents.</li>
  <li><strong>Document</strong>: A set of key-value pairs (similar to JSON objects).</li>
</ul>

<pre><code class="language-mermaid">graph 
  subgraph mongoDB["fa:fa-database MongoDB"]
    database["fa:fa-folder Database"]
    database --&gt; collection["fa:fa-folder-open Collection"]
    collection --&gt; document["fa:fa-file Document"]
  end

  style mongoDB stroke:#333,stroke-width:2px
  style database fill:#ccf,stroke:#f66,stroke-width:2px
  style collection fill:#add8e6,stroke:#333,stroke-width:2px
  style document fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<h2 id="crud-operations"><span class="me-2">CRUD Operations</span><a href="#crud-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>CRUD stands for Create, Read, Update, and Delete. These are the basic operations for interacting with data in MongoDB.</p>

<pre><code class="language-mermaid">graph
  subgraph crudOperations["fa:fa-tools CRUD Operations"]
    create["fa:fa-plus-circle Create"] --&gt; read["fa:fa-eye Read"]
    read --&gt; update["fa:fa-edit Update"]
    update --&gt; delete["fa:fa-trash Delete"]
  end

  style crudOperations stroke:#333,stroke-width:2px
  style create fill:#ccf,stroke:#f66,stroke-width:2px
  style read fill:#add8e6,stroke:#333,stroke-width:2px
  style update fill:#9cf,stroke:#333,stroke-width:2px
  style delete fill:#faa,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="create"><span class="me-2">Create</span><a href="#create" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To insert a new document into a collection, you use the <code class="language-plaintext highlighter-rouge">insertOne()</code> or <code class="language-plaintext highlighter-rouge">insertMany()</code> methods.</p>

<h4 id="insertone"><span class="me-2">insertOne</span><a href="#insertone" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Auto-Generated _id Field</strong>
If you donâ€™t specify an <code class="language-plaintext highlighter-rouge">_id</code> field, MongoDB automatically generates a unique identifier for each document. To specify your own <code class="language-plaintext highlighter-rouge">_id</code> value, you can include it in the document.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Make sure to handle duplicate <code class="language-plaintext highlighter-rouge">_id</code> values to avoid conflicts.</p>

<h4 id="insertmany"><span class="me-2">insertMany</span><a href="#insertmany" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>To insert multiple documents, you can use the <code class="language-plaintext highlighter-rouge">insertMany()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">insertMany</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bob</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">30</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If one of the documents fails to insert, the operation will be aborted unless you specify the <code class="language-plaintext highlighter-rouge">ordered: false</code> option.</p>

<p>For example if you have schema vadiation like this. <a href="#schema-validation">Go to Schema Validation</a></p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">validator</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">$jsonSchema</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">bsonType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">},</span>
        <span class="na">age</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">int</span><span class="dl">'</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">insertMany</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bob</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Charlie</span><span class="dl">'</span> <span class="p">}</span> <span class="c1">// missing age field</span>
<span class="p">],</span> <span class="p">{</span> <span class="na">ordered</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Third document will be ignored and first two will be inserted.</p>

<p>The result would be</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="nl">acknowledged</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">insertedIds</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">),</span>  <span class="c1">// ID for Alice</span>
    <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">)</span>   <span class="c1">// ID for Bob</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="read"><span class="me-2">Read</span><a href="#read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To read documents from a collection, you use the <code class="language-plaintext highlighter-rouge">find()</code> method. The find() method retrives multiple documents and returns a cursor which can be iterated to access the documents.</p>

<h4 id="find"><span class="me-2">find</span><a href="#find" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">find</span><span class="p">({</span> <span class="na">age</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gte</span><span class="p">:</span> <span class="mi">18</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In Node.js, you can convert the cursor to an array using the <code class="language-plaintext highlighter-rouge">toArray()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cursor</span><span class="p">.</span><span class="nf">toArray</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">docs</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result:</strong></p>
<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bob"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h4 id="findone"><span class="me-2">findOne</span><a href="#findone" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>To retrieve a single document, you can use the <code class="language-plaintext highlighter-rouge">findOne()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">findOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result:</strong></p>
<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w"> </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h4 id="projection"><span class="me-2">Projection</span><a href="#projection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>You can specify which fields to include or exclude in the result using the projection parameter.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">find</span><span class="p">({},</span> <span class="p">{</span> <span class="na">projection</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result:</strong></p>
<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bob"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Using projection is a critical practice, especially when working with large collections. It reduces the amount of data transferred over the network and improves query performance. It also prevent unintentional exposure of sensitive data.</p>

<h3 id="update"><span class="me-2">Update</span><a href="#update" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To update existing documents, you use the <code class="language-plaintext highlighter-rouge">updateOne()</code> or <code class="language-plaintext highlighter-rouge">updateMany()</code> methods.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">26</span> <span class="p">}</span> <span class="p">});</span>

<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateMany</span><span class="p">({</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New York</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">San Francisco</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result Object</strong></p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"matchedCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nl">"modifiedCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nl">"upsertedId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"upsertedCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Base on the result object you can return proper response.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">30</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">);</span>

<span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">matchedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">No matching document found</span><span class="dl">'</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">modifiedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Document already up-to-date</span><span class="dl">'</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Document updated successfully</span><span class="dl">'</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="upsert"><span class="me-2">Upsert</span><a href="#upsert" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>If you want to insert a new document when no matching document is found, you can use the <code class="language-plaintext highlighter-rouge">upsert</code> option.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">26</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="na">upsert</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result Object</strong></p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="dl">"</span><span class="s2">acknowledged</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">matchedCount</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">modifiedCount</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">upsertedId</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">upsertedCount</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="findoneandupdate"><span class="me-2">findOneAndUpdate</span><a href="#findoneandupdate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>This method is a combination of <code class="language-plaintext highlighter-rouge">findOne()</code> and <code class="language-plaintext highlighter-rouge">updateOne()</code> as atomic operation. Atomic operation are operations that are performed as a single unit of work. This helps to prevent race conditions and ensure data consistency.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// Update or create a user profile</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nf">findOneAndUpdate</span><span class="p">(</span>
    <span class="p">{</span> <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">alice@example.com</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">26</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">returnDocument</span><span class="p">:</span> <span class="dl">'</span><span class="s1">after</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result Object</strong></p>

<p><code class="language-plaintext highlighter-rouge">returnDocument</code> can be â€˜beforeâ€™ or â€˜afterâ€™ to return the document before or after the update.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
    <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">5f7d3b1c8e1f9a1c9c8e1f9a</span><span class="dl">"</span><span class="p">),</span>
        <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">alice@example.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Alice</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">lastErrorObject</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">updatedExisting</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">n</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<h4 id="update-operators"><span class="me-2">Update Operators</span><a href="#update-operators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<pre><code class="language-mermaid">
graph LR
  subgraph updateOperators["fa:fa-sync Update Operators"]
    set["fa:fa-equals $set"]
    inc["fa:fa-plus $inc"]
    mul["fa:fa-times $mul"]
    unset["fa:fa-trash-alt $unset"]
    rename["fa:fa-i-cursor $rename"]
  end

  style updateOperators stroke:#333,stroke-width:2px
  style set fill:#ccf,stroke:#f66,stroke-width:2px
  style inc fill:#add8e6,stroke:#333,stroke-width:2px
  style mul fill:#9cf,stroke:#333,stroke-width:2px
  style unset fill:#faa,stroke:#333,stroke-width:2px
  style rename fill:#f9f,stroke:#333,stroke-width:2px
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1">// $set operator to update fields</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New York</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>

<span class="c1">// $set operator to update nested fields</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">address.city</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New York</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>

<span class="c1">// $inc operator to increment a field</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$inc</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>

<span class="c1">// $mul operator to multiply a field value</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$mul</span><span class="p">:</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">});</span>

<span class="c1">// $unset operator to remove a field</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$unset</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="dl">''</span> <span class="p">}</span> <span class="p">});</span>

<span class="c1">// $rename operator to rename a field</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$rename</span><span class="p">:</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">location</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="delete"><span class="me-2">Delete</span><a href="#delete" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To delete documents from a collection, you use the <code class="language-plaintext highlighter-rouge">deleteOne()</code> or <code class="language-plaintext highlighter-rouge">deleteMany()</code> methods.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span> <span class="c1">// delete first matching document</span>

<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">deleteMany</span><span class="p">({</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New York</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result Object</strong></p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deletedCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Based on the result object you can return proper response.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">});</span>

<span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">deletedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">No matching document found</span><span class="dl">'</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Document deleted successfully</span><span class="dl">'</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Backup your data</strong>: Before deleting documents, make sure to back up your data to prevent accidental data loss.</p>

<p><strong>Soft Delete</strong>: Instead of permanently deleting documents, you can mark them as deleted by adding a <code class="language-plaintext highlighter-rouge">deletedAt</code> field. This allows you to retain the data for auditing or recovery purposes.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">deletedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Precise Filter</strong>: When deleting documents, use a precise filter to avoid unintentionally deleting more documents than intended. You can use find() to preview the documents that will be deleted before running the delete operation.</p>

<h2 id="schema-validation"><span class="me-2">Schema Validation</span><a href="#schema-validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h2 id="model-vs-dao-pattern"><span class="me-2">Model vs DAO Pattern</span><a href="#model-vs-dao-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="sample-todo-model"><span class="me-2">Sample Todo Model</span><a href="#sample-todo-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>Model Pattern</strong></p>
<ul>
  <li>Encapsulates both data and behavior. This may include validation, business logic, and database operations. This can become â€œfatâ€ but simpler implementation.</li>
</ul>

<pre><code class="language-mermaid">graph TD
    subgraph "Model Approach"
        A1[routes/todo.routes.js] --&gt; B1[controllers/todo.controller.js]
        B1 --&gt; C1[models/todo.model.js]
        C1 --&gt; D1[config/database.js]
        style C1 fill:#f9f,stroke:#333
    end
</code></pre>

<p>This is sample of files structure for Model Pattern</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ todo.model.js
â”‚
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ todo.controller.js
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ todo.routes.js
â”‚
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.middleware.js
â”‚
â””â”€â”€ app.js
</pre></td></tr></tbody></table></code></div></div>
<p>If the model becomes too complex, you can split it into multiple files or classes. For example, you can have separate files for validation, business logic, and database operations.</p>

<h4 id="data-configuration"><span class="me-2">Data Configuration</span><a href="#data-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="c1">// src/config/database.js</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">dbConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGODB_URI</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">mongodb://localhost:27017</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">dbName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">todoapp</span><span class="dl">'</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">db</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">connectDB</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">MongoClient</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="nx">dbConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">});</span>
    <span class="nx">db</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span><span class="nx">dbConfig</span><span class="p">.</span><span class="nx">dbName</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected to MongoDB successfully</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">MongoDB connection error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">getDB</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database not initialized</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">connectDB</span><span class="p">,</span> <span class="nx">getDB</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="model"><span class="me-2">Model</span><a href="#model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The model file contains the data structure, validation, and database operations for a todo item. This contains both data and behavior related to todos.</p>
<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
</pre></td><td class="rouge-code"><pre><span class="c1">// src/models/todo.model.js</span>
<span class="nx">onst</span> <span class="p">{</span> <span class="nx">ObjectId</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">getDB</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../config/database</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">COLLECTION_NAME</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">todos</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Validation functions</span>
<span class="kd">const</span> <span class="nx">validateTodoData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">todoData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Title is required</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Title must be at least 3 characters long</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">status</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">[</span><span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">in-progress</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">status</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid status. Must be pending, in-progress, or completed</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">&amp;&amp;</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Due date cannot be in the past</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">priority</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">[</span><span class="dl">'</span><span class="s1">low</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">todoData</span><span class="p">.</span><span class="nx">priority</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid priority. Must be low, medium, or high</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">errors</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">todoModel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nf">create</span><span class="p">(</span><span class="nx">todoData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validateTodoData</span><span class="p">(</span><span class="nx">todoData</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="s2">`Validation failed: </span><span class="p">${</span><span class="nx">errors</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">todoData</span><span class="p">,</span>
      <span class="na">title</span><span class="p">:</span> <span class="nx">todoData</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nf">trim</span><span class="p">(),</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">todoData</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">priority</span><span class="p">:</span> <span class="nx">todoData</span><span class="p">.</span><span class="nx">priority</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(),</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(),</span>
      <span class="na">completedAt</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">).</span><span class="nf">insertOne</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">todo</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">insertedId</span> <span class="p">};</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid todo ID</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">).</span><span class="nf">findOne</span><span class="p">({</span> 
      <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> 
    <span class="p">});</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">todo</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nf">find</span><span class="p">(</span><span class="nx">query</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="kd">const</span> <span class="p">{</span> 
      <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
      <span class="nx">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
      <span class="nx">sortBy</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">createdAt</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">sortOrder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">page</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid pagination parameters</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">skip</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">limit</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">sortOptions</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">sortBy</span><span class="p">]:</span> <span class="nx">sortOrder</span> <span class="p">};</span>

    <span class="c1">// Apply filters</span>
    <span class="kd">const</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">query</span> <span class="p">};</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="dl">'</span><span class="s1">low</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">priority</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid priority filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">in-progress</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">status</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid status filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">totalCount</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">all</span><span class="p">([</span>
      <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="nx">sortOptions</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">skip</span><span class="p">(</span><span class="nx">skip</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">toArray</span><span class="p">(),</span>
      <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">countDocuments</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">todos</span><span class="p">,</span>
      <span class="na">pagination</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">total</span><span class="p">:</span> <span class="nx">totalCount</span><span class="p">,</span>
        <span class="nx">page</span><span class="p">,</span>
        <span class="nx">limit</span><span class="p">,</span>
        <span class="na">pages</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="nx">totalCount</span> <span class="o">/</span> <span class="nx">limit</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid todo ID</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validateTodoData</span><span class="p">(</span><span class="nx">updateData</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="s2">`Validation failed: </span><span class="p">${</span><span class="nx">errors</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">existingTodo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

    <span class="c1">// Business logic for status changes</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">updateData</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">existingTodo</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">updateData</span><span class="p">.</span><span class="nx">completedAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">updateData</span><span class="p">.</span><span class="nx">status</span> <span class="o">&amp;&amp;</span> <span class="nx">updateData</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">updateData</span><span class="p">.</span><span class="nx">completedAt</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">).</span><span class="nf">findOneAndUpdate</span><span class="p">(</span>
      <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">},</span>
      <span class="p">{</span> 
        <span class="na">$set</span><span class="p">:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">updateData</span><span class="p">,</span>
          <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="na">returnDocument</span><span class="p">:</span> <span class="dl">'</span><span class="s1">after</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid todo ID</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">).</span><span class="nf">deleteOne</span><span class="p">({</span>
      <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">deletedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Additional business logic methods</span>
  <span class="k">async</span> <span class="nf">markAsComplete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span> 
      <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nf">findOverdue</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">getDB</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">COLLECTION_NAME</span><span class="p">).</span><span class="nf">find</span><span class="p">({</span>
      <span class="na">dueDate</span><span class="p">:</span> <span class="p">{</span> <span class="na">$lt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="p">},</span>
      <span class="na">status</span><span class="p">:</span> <span class="p">{</span> <span class="na">$ne</span><span class="p">:</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">}).</span><span class="nf">toArray</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="sample-todo-dao"><span class="me-2">Sample Todo DAO</span><a href="#sample-todo-dao" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>DAO Pattern</strong></p>

<ul>
  <li>Data Access logic is separated from business logic.</li>
  <li>Service layer for business logic and DAO layer for data access.</li>
  <li>Better for testing by mocking the data access layer.</li>
  <li>Better support dependency injection.</li>
  <li>More complex implementation and code repetition.</li>
</ul>

<pre><code class="language-mermaid">graph TD  
    subgraph "DAO Pattern Approach"
        A2[routes/todo.routes.js] --&gt; B2[controllers/todo.controller.js]
        B2 --&gt; C2[services/todo.service.js]
        C2 --&gt; D2[daos/todo.dao.js]
        D2 --&gt; E2[models/todo.entity.js]
        D2 --&gt; F2[config/database.js]
        style C2 fill:#f9f,stroke:#333
        style D2 fill:#f9f,stroke:#333
        style E2 fill:#f9f,stroke:#333
    end
</code></pre>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js         <span class="c"># Database connection configuration</span>
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ todo.entity.js      <span class="c"># Data structure/schema definition</span>
â”‚
â”œâ”€â”€ daos/
â”‚   â””â”€â”€ todo.dao.js         <span class="c"># Data Access Object - handles database operations</span>
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ todo.service.js     <span class="c"># Business logic layer</span>
â”‚
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ todo.controller.js  <span class="c"># Request handling &amp; response formatting</span>
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ todo.routes.js      <span class="c"># Route definitions</span>
â”‚
â””â”€â”€ app.js                  <span class="c"># Application entry point</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="database-configuration"><span class="me-2">Database Configuration</span><a href="#database-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre><span class="c1">// src/config/database.js</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">class</span> <span class="nc">Database</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGODB_URI</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">mongodb://localhost:27017</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">dbName</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">dbName</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">todoapp</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">...</span><span class="nx">config</span><span class="p">.</span><span class="nx">options</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">MongoClient</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">dbName</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected to MongoDB successfully</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">MongoDB connection error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to connect to database</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Disconnected from MongoDB</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">MongoDB disconnection error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to disconnect from database</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">getDB</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database not initialized. Call connect() first.</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="entity"><span class="me-2">Entity</span><a href="#entity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="c1">// src/models/todo.entity.js</span>
<span class="kd">class</span> <span class="nc">Todo</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">STATUS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">PENDING</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">IN_PROGRESS</span><span class="p">:</span> <span class="dl">'</span><span class="s1">in-progress</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">COMPLETED</span><span class="p">:</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span>
  <span class="p">};</span>

  <span class="kd">static</span> <span class="nx">PRIORITY</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">LOW</span><span class="p">:</span> <span class="dl">'</span><span class="s1">low</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">MEDIUM</span><span class="p">:</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">HIGH</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span>
  <span class="p">};</span>

  <span class="nf">constructor</span><span class="p">(</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">_id</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">description</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">PENDING</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">priority</span> <span class="o">||</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">PRIORITY</span><span class="p">.</span><span class="nx">MEDIUM</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">dueDate</span> <span class="p">?</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">)</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">createdAt</span> <span class="p">?</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">)</span> <span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="p">?</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">updatedAt</span><span class="p">)</span> <span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">completedAt</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">completedAt</span> <span class="p">?</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">completedAt</span><span class="p">)</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">tags</span><span class="p">)</span> <span class="p">?</span> <span class="p">[...</span><span class="nx">data</span><span class="p">.</span><span class="nx">tags</span><span class="p">]</span> <span class="p">:</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">assignedTo</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">assignedTo</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">validate</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">?.</span><span class="nf">trim</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Title is required</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nf">trim</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Title must be at least 3 characters long</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">).</span><span class="nf">includes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="s2">`Invalid status. Must be one of: </span><span class="p">${</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span> <span class="k">instanceof</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">||</span> <span class="nf">isNaN</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">.</span><span class="nf">getTime</span><span class="p">()))</span> <span class="p">{</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid due date format</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">&lt;</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Due date cannot be in the past</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">priority</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">PRIORITY</span><span class="p">).</span><span class="nf">includes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">priority</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="s2">`Invalid priority. Must be one of: </span><span class="p">${</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">PRIORITY</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Tags must be an array</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">errors</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">isOverdue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">&lt;</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">toJSON</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
      <span class="na">title</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
      <span class="na">description</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
      <span class="na">status</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
      <span class="na">priority</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">priority</span><span class="p">,</span>
      <span class="na">dueDate</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">,</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">updatedAt</span><span class="p">,</span>
      <span class="na">completedAt</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">completedAt</span><span class="p">,</span>
      <span class="na">tags</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span>
      <span class="na">assignedTo</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">assignedTo</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="validation-errors-class"><span class="me-2">Validation Errors Class</span><a href="#validation-errors-class" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="c1">// src/errors/index.js</span>
<span class="kd">class</span> <span class="nc">ValidationError</span> <span class="kd">extends</span> <span class="nc">Error</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ValidationError</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DatabaseError</span> <span class="kd">extends</span> <span class="nc">Error</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">originalError</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">DatabaseError</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">originalError</span> <span class="o">=</span> <span class="nx">originalError</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">NotFoundError</span> <span class="kd">extends</span> <span class="nc">Error</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">NotFoundError</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<h4 id="dao"><span class="me-2">DAO</span><a href="#dao" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><strong>Class-Based with Constructor Injection</strong></p>

<p>This style defines a BaseDAO class that provides a clean, reusable interface with methods like findOne, insertOne, and updateOne. Each DAO (like TodoDAO) extends BaseDAO, passing in a specific collection name</p>

<pre><code class="language-mermaid">classDiagram
    class DatabaseError {
        +String message
        +Error originalError
        +constructor(message, error)
    }

    class BaseDAO {
        -Database db
        -Collection collection
        +constructor(db, collectionName)
        +findOne(filter) Promise~Document~
        +find(filter, options) Promise~Document[]~
        +insertOne(data) Promise~Result~
        +updateOne(filter, update, options) Promise~Result~
        +deleteOne(filter) Promise~Result~
    }

    class TodoDAO {
        +constructor(db)
        +findByStatus(status) Promise~Document[]~
        +findByPriority(priority) Promise~Document[]~
    }

    class UserDAO {
        +constructor(db)
        +findByEmail(email) Promise~Document~
        +findByUsername(username) Promise~Document~
    }


    BaseDAO &lt;|-- TodoDAO : extends
    BaseDAO &lt;|-- UserDAO : extends
    BaseDAO ..&gt; DatabaseError : throws
</code></pre>

<p><strong>Pros:</strong></p>
<ul>
  <li><strong>Clean and reusable:</strong> BaseDAO is a good foundation, especially if you have multiple DAOs that follow similar structures.</li>
  <li><strong>Constructor validation</strong>: Ensures db and collectionName are provided, helping catch issues early.</li>
  <li><strong>Readability and maintainability</strong>: The CRUD operations are well-encapsulated and can be reused easily across different DAOs by extending BaseDAO.</li>
</ul>

<p><strong>Cons:</strong></p>
<ul>
  <li>More boilerplate code</li>
  <li>Every DAO must extend BaseDAO, which might limit flexibility for cases where a DAO might need additional initialization or a unique structure.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
</pre></td><td class="rouge-code"><pre><span class="c1">// src/daos/base.dao.js</span>
<span class="kd">class</span> <span class="nc">BaseDAO</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database connection is required</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">collectionName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Collection name is required</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">findOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database query failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">find</span><span class="p">(</span><span class="nx">filter</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nf">toArray</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database query failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">insertOne</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database insert failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">updateOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database update failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">deleteOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">deleteOne</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database delete failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// src/daos/todo.dao.js</span>
<span class="kd">class</span> <span class="nc">TodoDAO</span> <span class="kd">extends</span> <span class="nc">BaseDAO</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">db</span><span class="p">,</span> <span class="dl">'</span><span class="s1">todos</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">create</span><span class="p">(</span><span class="nx">todoData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Todo</span><span class="p">(</span><span class="nx">todoData</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">todo</span><span class="p">.</span><span class="nf">validate</span><span class="p">();</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">todoToInsert</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">todo</span><span class="p">.</span><span class="nf">toJSON</span><span class="p">(),</span>
      <span class="na">title</span><span class="p">:</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nf">trim</span><span class="p">(),</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(),</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">(</span><span class="nx">todoToInsert</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nc">Todo</span><span class="p">({</span> <span class="p">...</span><span class="nx">todoToInsert</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">insertedId</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to create todo</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid todo ID</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">});</span>
    
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nc">Todo</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">find</span><span class="p">(</span><span class="nx">query</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> 
      <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
      <span class="nx">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
      <span class="nx">sortBy</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">createdAt</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">sortOrder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="nx">status</span><span class="p">,</span>
      <span class="nx">priority</span><span class="p">,</span>
      <span class="nx">searchTerm</span><span class="p">,</span>
      <span class="nx">fromDate</span><span class="p">,</span>
      <span class="nx">toDate</span><span class="p">,</span>
      <span class="nx">tags</span>
    <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">page</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">limit</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid pagination parameters</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">filter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">_buildFilter</span><span class="p">({</span>
      <span class="p">...</span><span class="nx">query</span><span class="p">,</span>
      <span class="nx">status</span><span class="p">,</span>
      <span class="nx">priority</span><span class="p">,</span>
      <span class="nx">searchTerm</span><span class="p">,</span>
      <span class="nx">fromDate</span><span class="p">,</span>
      <span class="nx">toDate</span><span class="p">,</span>
      <span class="nx">tags</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">skip</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">limit</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">sortOptions</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">sortBy</span><span class="p">]:</span> <span class="nx">sortOrder</span> <span class="p">};</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">[</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">totalCount</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">all</span><span class="p">([</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span>
          <span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="nx">sortOptions</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">skip</span><span class="p">(</span><span class="nx">skip</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">toArray</span><span class="p">(),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">countDocuments</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
      <span class="p">]);</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="na">todos</span><span class="p">:</span> <span class="nx">todos</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">todo</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">Todo</span><span class="p">(</span><span class="nx">todo</span><span class="p">)),</span>
        <span class="na">pagination</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">total</span><span class="p">:</span> <span class="nx">totalCount</span><span class="p">,</span>
          <span class="nx">page</span><span class="p">,</span>
          <span class="nx">limit</span><span class="p">,</span>
          <span class="na">pages</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="nx">totalCount</span> <span class="o">/</span> <span class="nx">limit</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to fetch todos</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">existingTodo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">updatedTodo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Todo</span><span class="p">({</span>
      <span class="p">...</span><span class="nx">existingTodo</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">updateData</span><span class="p">,</span>
      <span class="na">_id</span><span class="p">:</span> <span class="nx">existingTodo</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">updatedTodo</span><span class="p">.</span><span class="nf">validate</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span>
      <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="nx">updatedTodo</span><span class="p">.</span><span class="nf">toJSON</span><span class="p">()</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">returnDocument</span><span class="p">:</span> <span class="dl">'</span><span class="s1">after</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">matchedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">updatedTodo</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid todo ID</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">});</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">deletedCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Todo not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">_buildFilter</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">filter</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">).</span><span class="nf">includes</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">status</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid status filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">Todo</span><span class="p">.</span><span class="nx">PRIORITY</span><span class="p">).</span><span class="nf">includes</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">priority</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid priority filter</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">priority</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">searchTerm</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">$or</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="na">$regex</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">searchTerm</span><span class="p">,</span> <span class="na">$options</span><span class="p">:</span> <span class="dl">'</span><span class="s1">i</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">description</span><span class="p">:</span> <span class="p">{</span> <span class="na">$regex</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">searchTerm</span><span class="p">,</span> <span class="na">$options</span><span class="p">:</span> <span class="dl">'</span><span class="s1">i</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span>
      <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fromDate</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">toDate</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">dueDate</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fromDate</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filter</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">.</span><span class="nx">$gte</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">fromDate</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">toDate</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filter</span><span class="p">.</span><span class="nx">dueDate</span><span class="p">.</span><span class="nx">$lte</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">toDate</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tags</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tags</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">filter</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span> <span class="na">$all</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">tags</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">filter</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Static Method with Injected Connection</strong></p>

<p><strong>Simplified Usage</strong>: Static methods remove the need to instantiate the class, reducing memory overhead.</p>

<p><strong>Testing Challenges</strong>: Static methods are less flexible with dependency injection, making mocks and tests trickier.</p>

<p><strong>Limited Reusability</strong>: Static methods donâ€™t support inheritance, so shared logic across DAOs is harder to centralize.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ObjectId</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">todos</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">TodoDAO</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">async</span> <span class="nf">injectDB</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">todos</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">todos</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span><span class="p">).</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">todos</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Unable to establish collection handles in TodoDAO: </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="nf">create</span><span class="p">(</span><span class="nx">todoData</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Initialize and validate the Todo, build the data object, and insert into the collection</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Validate ID, query by `_id`, throw `NotFoundError` if not found</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="nf">find</span><span class="p">(</span><span class="nx">query</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="c1">// Construct filter, pagination, and sort options, execute the find query with pagination</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fetch the todo, validate and update with `updateOne`</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Validate ID, delete by `_id`, and handle `NotFoundError`</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nf">_buildFilter</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate the filter object for queries based on status, priority, search terms, etc.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<h4 id="service"><span class="me-2">Service</span><a href="#service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="rouge-code"><pre><span class="c1">// src/services/todo.service.js</span>
<span class="kd">class</span> <span class="nc">TodoService</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">todoDAO</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">todoDAO</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">TodoDAO is required</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span> <span class="o">=</span> <span class="nx">todoDAO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">createTodo</span><span class="p">(</span><span class="nx">todoData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">todoData</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">getTodoById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">updateTodo</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">deleteTodo</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">updateTodoStatus</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">updates</span> <span class="o">=</span> <span class="p">{</span> 
      <span class="nx">status</span><span class="p">,</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span>
    <span class="p">};</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span> <span class="o">&amp;&amp;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">updates</span><span class="p">.</span><span class="nx">completedAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span> <span class="o">&amp;&amp;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">updates</span><span class="p">.</span><span class="nx">completedAt</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updates</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">findTodos</span><span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">find</span><span class="p">({},</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">findOverdueTodos</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span>
      <span class="na">dueDate</span><span class="p">:</span> <span class="p">{</span> <span class="na">$lt</span><span class="p">:</span> <span class="nx">now</span> <span class="p">},</span>
      <span class="na">status</span><span class="p">:</span> <span class="p">{</span> <span class="na">$ne</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">STATUS</span><span class="p">.</span><span class="nx">COMPLETED</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">findTodosByPriority</span><span class="p">(</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="nx">priority</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">assignTodo</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">assignedTo</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>
      <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">addTags</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">uniqueTags</span> <span class="o">=</span> <span class="p">[...</span><span class="k">new</span> <span class="nc">Set</span><span class="p">([...</span><span class="nx">todo</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">...</span><span class="nx">tags</span><span class="p">])];</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span> <span class="na">tags</span><span class="p">:</span> <span class="nx">uniqueTags</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">removeTags</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">updatedTags</span> <span class="o">=</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">tag</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">tags</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">tag</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoDAO</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span> <span class="na">tags</span><span class="p">:</span> <span class="nx">updatedTags</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="indexing"><span class="me-2">Indexing</span><a href="#indexing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Indexing in MongoDB improves query performance by creating efficient data structures for faster data retrieval.</p>

<pre><code class="language-mermaid">graph LR
  subgraph indexing["fa:fa-search Indexing"]
    singleField["fa:fa-file $singleField"]
    compound["fa:fa-layer-group $compound"]
    multikey["fa:fa-list $multikey"]
    text["fa:fa-font $text"]
  end

  style indexing stroke:#333,stroke-width:2px
  style singleField fill:#ccf,stroke:#f66,stroke-width:2px
  style compound fill:#add8e6,stroke:#333,stroke-width:2px
  style multikey fill:#9cf,stroke:#333,stroke-width:2px
  style text fill:#faa,stroke:#333,stroke-width:2px
</code></pre>

<ul>
  <li><strong>Single Field Index</strong>: Index on a single field of a document.</li>
  <li><strong>Compound Index</strong>: Index on multiple fields.</li>
  <li><strong>Multikey Index</strong>: Index on array fields.</li>
  <li><strong>Text Index</strong>: Supports text search queries on string content.</li>
</ul>

<h3 id="single-field-index"><span class="me-2">Single Field Index</span><a href="#single-field-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To create an index, you use the <code class="language-plaintext highlighter-rouge">createIndex()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="compound-index"><span class="me-2">Compound Index</span><a href="#compound-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A compound index in MongoDB is an index on multiple fields in a document.</p>

<pre><code class="language-mermaid">graph LR
  subgraph compoundIndex["fa:fa-layer-group Compound Index"]
    field1["fa:fa-file Field 1"]
    field2["fa:fa-file Field 2"]
    field3["fa:fa-file Field 3"]
  end

  style compoundIndex stroke:#333,stroke-width:2px
  style field1 fill:#ccf,stroke:#f66,stroke-width:2px
  style field2 fill:#add8e6,stroke:#333,stroke-width:2px
  style field3 fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">city</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">hobbies</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Prefixes of a compound index can be used to satisfy queries that match the index fields from left to right.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="na">city</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New York</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="multikey-index"><span class="me-2">Multikey Index</span><a href="#multikey-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A multikey index in MongoDB is an index on an array field.</p>

<pre><code class="language-mermaid">graph LR
  subgraph multikeyIndex["fa:fa-list Multikey Index"]
    arrayField["fa:fa-list Array Field"]
  end

  style multikeyIndex stroke:#333,stroke-width:2px
  style arrayField fill:#ccf,stroke:#f66,stroke-width:2px
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">hobbies</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="limitations-of-multikey-indexes"><span class="me-2">Limitations of Multikey Indexes</span><a href="#limitations-of-multikey-indexes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ul>
  <li>you cannot create a compound index if more than one field is an array.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">createIndex</span><span class="p">({</span> <span class="dl">"</span><span class="s2">hobbies</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">tags</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span> <span class="c1">// Not allowed if both hobbies and tags are arrays</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="text-index"><span class="me-2">Text Index</span><a href="#text-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Text indexes in MongoDB provide a way to perform text search queries on string content. Each collection can have at most one text index.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">createIndex</span><span class="p">({</span> 
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> 
  <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> 
  <span class="na">tags</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> 
<span class="p">});</span>

</pre></td></tr></tbody></table></code></div></div>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1">// Sample Data</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">insertMany</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MacBook Pro 16-inch</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Powerful laptop for developers</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">tags</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">apple</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">laptop</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">computer</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">iPhone 15 Pro</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Latest smartphone with great camera</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">tags</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">apple</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">smartphone</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mobile</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gaming Laptop ROG</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">High-performance gaming laptop</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">tags</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">asus</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">laptop</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">gaming</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Exact word matches</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">laptop</span><span class="dl">"</span> <span class="p">}});</span> <span class="c1">// Will find MacBook and ROG</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Multiple words (OR)</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// By default, multiple words are treated as logical OR</span>
<span class="c1">// Will find documents containing "laptop" or "gaming"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">laptop gaming</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>
<p><strong>Multiple Words (Logical AND)</strong></p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// Using the plus sign to ensure both terms are present</span>
<span class="c1">// Will find documents containing both "laptop" and "gaming"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">+laptop +gaming</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Exact phrases</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// Using double quotes to search for an exact phrase</span>
<span class="c1">// Will find documents containing the exact phrase "gaming laptop"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="se">\"</span><span class="s2">gaming laptop</span><span class="se">\"</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Word exclusions</strong>
db.products.find({ $text: { $search: â€œlaptop -gamingâ€ }}); // Laptops but not gaming ones</p>

<p><strong>Case-insensitive matches</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// Text search is case-insensitive by default</span>
<span class="c1">// Will find all documents containing "laptop" regardless of case</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">LAPTOP</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>
<p><strong>Diacritic-insensitive</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// Text search ignores diacritic marks by default</span>
<span class="c1">// Will match "cafe" and "cafÃ©"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cafÃ©</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Partial Word Matches</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Searching for "lap" won't find "laptop"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lap</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Wildcard Searches</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Wildcards are not supported in text search</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lap*</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Fuzzy Matching (Typos)</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Regular expressions cannot be used inside $text search</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/lap.*/</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Complex Boolean Expressions</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Nested boolean logic is not supported in $text search</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">(laptop AND gaming) OR (smartphone AND camera)</span><span class="dl">"</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Case-Sensitive Searches</strong></p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Cannot perform case-sensitive searches using $text</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">$text</span><span class="p">:</span> <span class="p">{</span> <span class="na">$search</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MacBook</span><span class="dl">"</span><span class="p">,</span> <span class="na">caseSensitive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="atlas-search"><span class="me-2">Atlas Search</span><a href="#atlas-search" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Atlas Search is a fully managed search service that allows you to build fast, relevant, full-text search capabilities on top of your MongoDB data. Compare to text indexes, Atlas Search provides more advanced features like faceted search, fuzzy matching, and relevance scoring.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">//  Basic Atlas Search Setup</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">createSearchIndex</span><span class="p">({</span>
  <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">dynamic</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">analyzer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lucene.standard</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">analyzer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lucene.english</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="fuzzy-matching---handles-typos-and-misspellings"><span class="me-2">Fuzzy Matching - Handles typos and misspellings</span><a href="#fuzzy-matching---handles-typos-and-misspellings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$search</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">labtop</span><span class="dl">"</span><span class="p">,</span>  <span class="c1">// Will match "laptop"</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">fuzzy</span><span class="p">:</span> <span class="p">{</span> <span class="na">maxEdits</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="autocomplete---real-time-suggestions"><span class="me-2">Autocomplete - Real-time suggestions</span><a href="#autocomplete---real-time-suggestions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$search</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">autocomplete</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mac</span><span class="dl">"</span><span class="p">,</span>     <span class="c1">// Will suggest "macbook", "machine", etc.</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>
<h4 id="custom-scoring---boost-relevance"><span class="me-2">Custom Scoring - Boost relevance</span><a href="#custom-scoring---boost-relevance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Can boost the relevance of certain documents based on specific criteria.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$search</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">compound</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">must</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="p">{</span> <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">laptop</span><span class="dl">"</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span> <span class="p">}</span> <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">should</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gaming</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">category</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">score</span><span class="p">:</span> <span class="p">{</span> <span class="na">boost</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mf">2.0</span> <span class="p">}</span> <span class="p">}</span>  <span class="c1">// Boost gaming laptops</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Documents must contain â€œlaptopâ€ in the name field</li>
  <li>Documents containing â€œgamingâ€ in the description field are boosted.</li>
</ul>

<h4 id="multi-language-support"><span class="me-2">Multi-language Support</span><a href="#multi-language-support" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$search</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ordinateur portable</span><span class="dl">"</span><span class="p">,</span>  <span class="c1">// French for "laptop"</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">analyzer</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lucene.french</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="faceted-search---filter-results"><span class="me-2">Faceted Search - Filter results</span><a href="#faceted-search---filter-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Faceted search allows users to filter search results based on categories, price ranges, and other attributes.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$searchMeta</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">facet</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">operator</span><span class="p">:</span> <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="p">{</span> <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">laptop</span><span class="dl">"</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span> <span class="p">}</span> <span class="p">},</span>
        <span class="na">facets</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">categories</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">category</span><span class="dl">"</span> <span class="p">},</span>
          <span class="na">priceRanges</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">price</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">boundaries</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>

<span class="o">**</span><span class="nx">Facets</span><span class="p">:</span><span class="o">**</span>
<span class="o">-</span> <span class="nx">categoryFacet</span><span class="p">:</span> <span class="nx">Groups</span> <span class="nx">results</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">category</span> <span class="nx">field</span><span class="p">.</span>
<span class="o">-</span> <span class="nx">priceFacet</span><span class="p">:</span> <span class="nx">Groups</span> <span class="nx">results</span> <span class="nx">into</span> <span class="nx">price</span> <span class="nx">ranges</span> <span class="nx">defined</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">boundaries</span><span class="p">.</span>


</pre></td></tr></tbody></table></code></div></div>
<h4 id="trade-offs"><span class="me-2">Trade-offs</span><a href="#trade-offs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Besides the benefits, Atlas Search also has some trade-offs compared to traditional text indexes.</p>

<ul>
  <li>Requires M10+ clusters</li>
  <li>Additional cost</li>
  <li>More complex setup</li>
  <li>Higher resource usage</li>
</ul>

<h2 id="array-operations"><span class="me-2">Array Operations</span><a href="#array-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>MongoDB supports a variety of array operations for working with arrays in documents.</p>

<pre><code class="language-mermaid">
graph 

  subgraph  
    each["fa:fa-list $each"]
    in["fa:fa-rectangle-list $in"]
    gt["fa:fa-angle-double-right $gt"]
    ne["fa:fa-angle-double-left $ne"]
  end


  subgraph     
    pull["fa:fa-trash-alt $pull"]
    pop["fa:fa-trash-alt $pop"]
    pullAll["fa:fa-trash-alt $pullAll"]
  end

    subgraph arrayOperations["fa:fa-list Array Operations"]
    elementMatch["fa:fa-equals $elementMatch"]
    push["fa:fa-plus $push"]
    set["fa:fa-hammer $set"]
    addToSet["fa:fa-plus-square $addToSet"]
  end


  style elementMatch fill:#add8e6, stroke:#333,stroke-width:2px
  style arrayOperations stroke:#333,stroke-width:2px
  style push fill:#ccf,stroke:#f66,stroke-width:2px
  style addToSet fill:#add8e6,stroke:#333,stroke-width:2px
  style each fill:#9cf,stroke:#333,stroke-width:2px
  style pull fill:#9cf,stroke:#333,stroke-width:2px
  style pop fill:#faa,stroke:#333,stroke-width:2px
  style pullAll fill:#ccf,stroke:#f66,stroke-width:2px
  style in fill:#add8e6,stroke:#333,stroke-width:2px
  style gt fill:#9cf,stroke:#333,stroke-width:2px
  style ne fill:#faa,stroke:#333,stroke-width:2px

</code></pre>

<h3 id="adding-elements-to-an-array"><span class="me-2">Adding Elements to an Array</span><a href="#adding-elements-to-an-array" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To add elements to an array in a document, you use the <code class="language-plaintext highlighter-rouge">$push</code> operator.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$push</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="querying-arrays-with-elemmatch"><span class="me-2">Querying Arrays with <code class="language-plaintext highlighter-rouge">$elemMatch</code></span><a href="#querying-arrays-with-elemmatch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Given a collection of students with scores in different subjects:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">64d39a7a8b0e8c284a2c1234</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Alice</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">scores</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Math</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span> <span class="mi">95</span> <span class="p">},</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span> <span class="mi">88</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">64d39a808b0e8c284a2c1235</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">scores</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Math</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span> <span class="mi">78</span> <span class="p">},</span>
    <span class="p">{</span> <span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">score</span><span class="dl">"</span><span class="p">:</span> <span class="mi">92</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Querying with $elemMatch:</strong></p>

<p>To find students who specifically scored above 90 in Math, we need <code class="language-plaintext highlighter-rouge">$elemMatch</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">students</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> 
  <span class="na">scores</span><span class="p">:</span> <span class="p">{</span> 
    <span class="na">$elemMatch</span><span class="p">:</span> <span class="p">{</span> <span class="na">subject</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Math</span><span class="dl">"</span><span class="p">,</span> <span class="na">score</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">90</span> <span class="p">}</span> <span class="p">}</span> 
  <span class="p">}</span> 
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Result:</strong> This will return only Alice, as she is the only student with a score above 90 in the â€œMathâ€ subject. <code class="language-plaintext highlighter-rouge">$elemMatch</code> ensures that <em>all</em> the conditions within the array element must be met.</p>

<p>Without <code class="language-plaintext highlighter-rouge">$elemMatch</code> - This will return both Alice and Bob, as they both have scores above 90 in different subjects and not necessarily in the â€œMathâ€ subject.</p>

<pre><code class="language-mermaid">graph 
  subgraph query["Query"]
    elemMatchMath["scores { $elemMatch: { subject: 'Math', score: { $gt: 90 } } }"]
  end

  subgraph documents["Documents"]
    alice["Alice: { scores: [{ subject: 'Math', score: 95 }, { subject: 'English', score: 88 }] }"]
    bob["Bob: { scores: [{ subject: 'Math', score: 78 }, { subject: 'English', score: 92 }] }"]
  end



  elemMatchMath --&gt;  alice --&gt; found["âœ…"]
  elemMatchMath --&gt; bob 
  bob --&gt; |With $elemMatch|notFound["âŒ"]
   bob --&gt; |Without $elemMatch|found2["âœ…"]

  style found fill:#90EE90
  style notFound fill:#FFCCCC

</code></pre>

<h3 id="add-unique---addtoset"><span class="me-2">Add Unique - <code class="language-plaintext highlighter-rouge">$addToSet</code></span><a href="#add-unique---addtoset" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$addToSet</code> operator in MongoDB is used to add elements to an array only if they are not already present. This prevents duplicate entries in the array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$addToSet</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="add-multiple--push-and-each"><span class="me-2">Add Multiple  <code class="language-plaintext highlighter-rouge">$push</code> and <code class="language-plaintext highlighter-rouge">$each</code></span><a href="#add-multiple--push-and-each" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$push</code> operator in MongoDB is used to add elements to an array. The <code class="language-plaintext highlighter-rouge">$each</code> modifier allows you to add multiple elements to the array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$push</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="p">{</span> <span class="na">$each</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Swimming</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="add-sorted----push-and-sort"><span class="me-2">Add Sorted -  <code class="language-plaintext highlighter-rouge">$push</code> and <code class="language-plaintext highlighter-rouge">$sort</code></span><a href="#add-sorted----push-and-sort" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$push</code> operator in MongoDB is used to add elements to an array. The <code class="language-plaintext highlighter-rouge">$sort</code> modifier allows you to sort the array elements.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$push</span><span class="p">:</span> <span class="p">{</span> <span class="na">scores</span><span class="p">:</span> <span class="p">{</span> <span class="na">$each</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="na">$sort</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Push and Sort Array of Objects by a specific field</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">$push</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">scores</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">$each</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span> <span class="na">score</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span> <span class="na">date</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2023-03-01</span><span class="dl">"</span> <span class="p">},</span>
          <span class="p">{</span> <span class="na">score</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="na">date</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2023-04-01</span><span class="dl">"</span> <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">$sort</span><span class="p">:</span> <span class="p">{</span> <span class="na">date</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="add-limited----push-and-slice"><span class="me-2">Add Limited -  <code class="language-plaintext highlighter-rouge">$push</code> and <code class="language-plaintext highlighter-rouge">$slice</code></span><a href="#add-limited----push-and-slice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$push</code> operator in MongoDB is used to add elements to an array. The <code class="language-plaintext highlighter-rouge">$slice</code> modifier allows you to limit the number of elements in the array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$push</span><span class="p">:</span> <span class="p">{</span> <span class="na">scores</span><span class="p">:</span> <span class="p">{</span> <span class="na">$each</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="na">$slice</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If Alice currently has a scores array like [70, 75, 80], this query will push 85 and 90, making it [70, 75, 80, 85, 90]. The $slice: -3 will then trim it to the last 3 elements, resulting in [80, 85, 90].</p>

<h3 id="removing-elements-from-an-array"><span class="me-2">Removing Elements from an Array</span><a href="#removing-elements-from-an-array" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To remove elements from an array in a document, you use the <code class="language-plaintext highlighter-rouge">$pull</code> operator.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pull</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="remove-the-first-or-last-element---pop"><span class="me-2">Remove the first or last element - <code class="language-plaintext highlighter-rouge">$pop</code></span><a href="#remove-the-first-or-last-element---pop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$pop</code> operator in MongoDB is used to remove the first or last element from an array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pop</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="remove-multiple----pullall"><span class="me-2">Remove Multiple -  <code class="language-plaintext highlighter-rouge">$pullAll</code></span><a href="#remove-multiple----pullall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$pullAll</code> operator in MongoDB is used to remove all occurrences of specified values from an array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pullAll</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Swimming</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="remove-multiple---pull-and-in"><span class="me-2">Remove Multiple - <code class="language-plaintext highlighter-rouge">$pull</code> and <code class="language-plaintext highlighter-rouge">$in</code></span><a href="#remove-multiple---pull-and-in" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$pull</code> operator in MongoDB is used to remove elements from an array. The <code class="language-plaintext highlighter-rouge">$in</code> modifier allows you to specify multiple values to remove.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pull</span><span class="p">:</span> <span class="p">{</span> <span class="na">hobbies</span><span class="p">:</span> <span class="p">{</span> <span class="na">$in</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Reading</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Swimming</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="remove-condition---pull-and-gt"><span class="me-2">Remove Condition - <code class="language-plaintext highlighter-rouge">$pull</code> and <code class="language-plaintext highlighter-rouge">$gt</code></span><a href="#remove-condition---pull-and-gt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$pull</code> operator in MongoDB is used to remove elements from an array. The <code class="language-plaintext highlighter-rouge">$gt</code> modifier allows you to specify a condition for removing elements.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pull</span><span class="p">:</span> <span class="p">{</span> <span class="na">scores</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">85</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<h3 id="remove-not-equal---pull-and-ne"><span class="me-2">Remove Not Equal - <code class="language-plaintext highlighter-rouge">$pull</code> and <code class="language-plaintext highlighter-rouge">$ne</code></span><a href="#remove-not-equal---pull-and-ne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$pull</code> operator in MongoDB is used to remove elements from an array. The <code class="language-plaintext highlighter-rouge">$ne</code> modifier allows you to specify a condition for removing elements that are not equal to a value.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$pull</span><span class="p">:</span> <span class="p">{</span> <span class="na">scores</span><span class="p">:</span> <span class="p">{</span> <span class="na">$ne</span><span class="p">:</span> <span class="mi">85</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="update-condition---set-and-"><span class="me-2">Update Condition - <code class="language-plaintext highlighter-rouge">$set</code> and <code class="language-plaintext highlighter-rouge">$</code></span><a href="#update-condition---set-and-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$set</code> operator in MongoDB is used to update fields in a document. The <code class="language-plaintext highlighter-rouge">$</code> positional operator allows you to update the first element that matches a condition in an array.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">scores.subject</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Math</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">scores.$.score</span><span class="dl">'</span><span class="p">:</span> <span class="mi">90</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="update-all---"><span class="me-2">Update All - <code class="language-plaintext highlighter-rouge">$[]</code></span><a href="#update-all---" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$[]</code> operator in MongoDB is used to update all elements in an array that match a condition.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">scores.$[].score</span><span class="dl">'</span><span class="p">:</span> <span class="mi">90</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>To increment a field in all elements of an array, you can use the <code class="language-plaintext highlighter-rouge">$[]</code> operator with the <code class="language-plaintext highlighter-rouge">$inc</code> operator.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$inc</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">scores.$[].score</span><span class="dl">'</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<h3 id="update-filtered---identifier"><span class="me-2">Update Filtered - <code class="language-plaintext highlighter-rouge">$[&lt;identifier&gt;]</code></span><a href="#update-filtered---identifier" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$[&lt;identifier&gt;]</code> operator in MongoDB is used to update elements in an array that match a condition.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">scores.$[elem].score</span><span class="dl">'</span><span class="p">:</span> <span class="mi">90</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="na">arrayFilters</span><span class="p">:</span> <span class="p">[{</span> <span class="dl">'</span><span class="s1">elem.subject</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Math</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="aggregation"><span class="me-2">Aggregation</span><a href="#aggregation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Aggregation operations process data records and return computed results. Aggregation allows you to perform complex data processing and transformation.</p>

<h3 id="aggregation-pipeline"><span class="me-2">Aggregation Pipeline</span><a href="#aggregation-pipeline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The aggregation framework in MongoDB uses a pipeline approach, where multiple stages transform the documents.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$match</span><span class="p">:</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">A</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$cust_id</span><span class="dl">'</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$sort</span><span class="p">:</span> <span class="p">{</span> <span class="na">total</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<pre><code class="language-mermaid">graph
  subgraph aggregation["fa:fa-chart-line Aggregation"]
    stage1["fa:fa-filter Match"] --&gt; stage2["fa:fa-layer-group Group"]
    stage2 --&gt; stage3["fa:fa-sort Sort"]
  end

  style aggregation stroke:#333,stroke-width:2px
  style stage1 fill:#ccf,stroke:#f66,stroke-width:2px
  style stage2 fill:#add8e6,stroke:#333,stroke-width:2px
  style stage3 fill:#9cf,stroke:#333,stroke-width:2px

</code></pre>

<h3 id="join-collections"><span class="me-2">Join Collections</span><a href="#join-collections" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>MongoDB does not support joins like relational databases. Instead, you can use the <code class="language-plaintext highlighter-rouge">$lookup</code> operator to perform a left outer join between two collections.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">customers</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">localField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cust_id</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">foreignField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">_id</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">as</span><span class="p">:</span> <span class="dl">'</span><span class="s1">customer</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<pre><code class="language-mermaid">
graph
  subgraph joinCollections["fa:fa-link Join Collections"]
    orders["fa:fa-folder-open Orders"]
    customers["fa:fa-folder-open Customers"]
  end

  orders --&gt; |$lookup| customers

  style joinCollections stroke:#333,stroke-width:2px
  style orders fill:#ccf,stroke:#f66,stroke-width:2px
  style customers fill:#add8e6,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="unwind-arrays"><span class="me-2">Unwind Arrays</span><a href="#unwind-arrays" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$unwind</code> operator in MongoDB is used to deconstruct an array field into multiple documents.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$unwind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="unwind-and-group"><span class="me-2">Unwind and Group</span><a href="#unwind-and-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$unwind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items.productId</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">totalQuantity</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items.quantity</span><span class="dl">'</span> <span class="p">},</span>
      <span class="na">totalRevenue</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="p">{</span> <span class="na">$multiply</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$items.price</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$items.quantity</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span> <span class="p">},</span>
      <span class="na">ordersCount</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="unwind-multiple-arrays"><span class="me-2">Unwind Multiple Arrays</span><a href="#unwind-multiple-arrays" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">restaurants</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$unwind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$categories</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$unwind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$reviews</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$categories</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">averageRating</span><span class="p">:</span> <span class="p">{</span> <span class="na">$avg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$reviews.rating</span><span class="dl">'</span> <span class="p">},</span>
      <span class="na">reviewCount</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="group-documents"><span class="me-2">Group Documents</span><a href="#group-documents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$group</code> operator in MongoDB is used to group documents by a specified key.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$cust_id</span><span class="dl">'</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-and-count"><span class="me-2">Group and Count</span><a href="#group-and-count" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$status</span><span class="dl">'</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-and-sum"><span class="me-2">Group and Sum</span><a href="#group-and-sum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$status</span><span class="dl">'</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-and-average"><span class="me-2">Group and Average</span><a href="#group-and-average" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$status</span><span class="dl">'</span><span class="p">,</span> <span class="na">average</span><span class="p">:</span> <span class="p">{</span> <span class="na">$avg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-and-push"><span class="me-2">Group and Push</span><a href="#group-and-push" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$cust_id</span><span class="dl">'</span><span class="p">,</span> <span class="na">items</span><span class="p">:</span> <span class="p">{</span> <span class="na">$push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$item</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-with-multiple-fields"><span class="me-2">Group with Multiple Fields</span><a href="#group-with-multiple-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> 
        <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$status</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">category</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$category</span><span class="dl">'</span>
      <span class="p">},</span>
      <span class="na">count</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="na">totalAmount</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="group-with-date-operations"><span class="me-2">Group with Date Operations</span><a href="#group-with-date-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">year</span><span class="p">:</span> <span class="p">{</span> <span class="na">$year</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$orderDate</span><span class="dl">'</span> <span class="p">},</span>
        <span class="na">month</span><span class="p">:</span> <span class="p">{</span> <span class="na">$month</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$orderDate</span><span class="dl">'</span> <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">totalOrders</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="na">revenue</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="project-fields"><span class="me-2">Project Fields</span><a href="#project-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">$project</code> operator in MongoDB is used to include, exclude, or rename fields in the output documents.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$project</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">cust_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">amount</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="project-with-computed-fields"><span class="me-2">Project with Computed Fields</span><a href="#project-with-computed-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">cust_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">amount</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">discount</span><span class="p">:</span> <span class="p">{</span> <span class="na">$subtract</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$total</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="project-with-array-operations"><span class="me-2">Project With Array Operations</span><a href="#project-with-array-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">orderId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">itemCount</span><span class="p">:</span> <span class="p">{</span> <span class="na">$size</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span> <span class="p">},</span>
      <span class="na">firstItem</span><span class="p">:</span> <span class="p">{</span> <span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">},</span>
      <span class="na">lastItem</span><span class="p">:</span> <span class="p">{</span> <span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">},</span>
      <span class="na">items</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">$map</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">input</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$items</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">as</span><span class="p">:</span> <span class="dl">'</span><span class="s1">item</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">in</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$$item.name</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">subtotal</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">$multiply</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$$item.price</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$$item.quantity</span><span class="dl">'</span><span class="p">]</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="project-with-string-operations"><span class="me-2">Project With String Operations</span><a href="#project-with-string-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fullName</span><span class="p">:</span> <span class="p">{</span> <span class="na">$concat</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$firstName</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$lastName</span><span class="dl">'</span><span class="p">]</span> <span class="p">},</span>
      <span class="na">email</span><span class="p">:</span> <span class="p">{</span> <span class="na">$toLower</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$email</span><span class="dl">'</span> <span class="p">},</span>
      <span class="na">age</span><span class="p">:</span> <span class="p">{</span> <span class="na">$toString</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$age</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="project-with-conditional-fields"><span class="me-2">Project With Conditional Fields</span><a href="#project-with-conditional-fields" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">status</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">$cond</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">if</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gte</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$age</span><span class="dl">'</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="p">},</span>
          <span class="na">then</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Adult</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">else</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Minor</span><span class="dl">'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="run-multiple-aggregations"><span class="me-2">Run Multiple Aggregations</span><a href="#run-multiple-aggregations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>You can run multiple aggregation pipelines in a single query using the <code class="language-plaintext highlighter-rouge">$facet</code> operator.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">orders</span><span class="dl">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">$facet</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">totalAmount</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
      <span class="p">],</span>
      <span class="na">averageAmount</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="na">average</span><span class="p">:</span> <span class="p">{</span> <span class="na">$avg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$amount</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="transactions"><span class="me-2">Transactions</span><a href="#transactions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Transactions in MongoDB allow you to perform multiple operations as a single, all-or-nothing unit of work. They ensure data integrity and consistency across multiple documents and collections.</p>

<pre><code class="language-mermaid">graph LR
  start["fa:fa-play Start"]
  subgraph transaction["fa:fa-exchange-alt Transaction"]
    op1["fa:fa-cog Operation 1"]
    op2["fa:fa-cog Operation 2"]
    op3["fa:fa-cog Operation 3"]
  end

  start --&gt; transaction
  transaction --&gt; commit["fa:fa-check Commit"]
  transaction --&gt; abort["fa:fa-times Abort"]

  style transaction stroke:#333,stroke-width:2px
  style start fill:#ccf,stroke:#f66,stroke-width:2px
  style op1 fill:#add8e6,stroke:#333,stroke-width:2px
  style op2 fill:#add8e6,stroke:#333,stroke-width:2px
  style op3 fill:#add8e6,stroke:#333,stroke-width:2px
  style commit fill:#9cf,stroke:#333,stroke-width:2px
  style abort fill:#fcc,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="transaction-properties-acid"><span class="me-2">Transaction Properties (ACID)</span><a href="#transaction-properties-acid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<pre><code class="language-mermaid">graph LR
    subgraph acidProperties["ðŸ§ª ACID Properties"]
        atomicity["ðŸ’¥ Atomicity"]
        consistency["ðŸ”„ Consistency"]
        isolation["ðŸ”’ Isolation"]
        durability["ðŸ’¾ Durability"]
    end

    atomicity --&gt; |"All or Nothing"| atomicityDesc["Operations complete successfully or have no effect"]
    consistency --&gt; |"Before and After"| consistencyDesc["Database remains in a consistent state"]
    isolation --&gt; |"Concurrent Transactions"| isolationDesc["Do not interfere with each other"]
    durability --&gt; |"Committed Changes"| durabilityDesc["Persist despite system failures"]

    style acidProperties fill:#f0f0ff,stroke:#333,stroke-width:2px
    style atomicity fill:#e6f2ff,stroke:#333,stroke-width:2px
    style consistency fill:#e6ffe6,stroke:#333,stroke-width:2px
    style isolation fill:#fff0f0,stroke:#333,stroke-width:2px
    style durability fill:#fff0ff,stroke:#333,stroke-width:2px
    style atomicityDesc fill:#f0f8ff,stroke:#333,stroke-width:1px
    style consistencyDesc fill:#f0fff0,stroke:#333,stroke-width:1px
    style isolationDesc fill:#fff5f5,stroke:#333,stroke-width:1px
    style durabilityDesc fill:#fdf0ff,stroke:#333,stroke-width:1px
</code></pre>

<h3 id="using-transactions"><span class="me-2">Using Transactions</span><a href="#using-transactions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To use transactions in MongoDB, you typically follow these steps:</p>

<ol>
  <li>Start a session</li>
  <li>Start a transaction</li>
  <li>Perform operations</li>
  <li>Commit or abort the transaction</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1">// Define a client</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoClient</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb://localhost:27017</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//...</span>

<span class="c1">// Start a session</span>

<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">startSession</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nx">session</span><span class="p">.</span><span class="nf">startTransaction</span><span class="p">();</span>

  <span class="c1">// Perform multiple operations</span>
  <span class="k">await</span> <span class="nx">collection1</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">processing</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">session</span> <span class="p">});</span>
  <span class="k">await</span> <span class="nx">collection2</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">orderId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">items</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">item1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">item2</span><span class="dl">'</span><span class="p">]</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">session</span> <span class="p">});</span>

  <span class="c1">// Commit the transaction</span>
  <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">commitTransaction</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// If an error occurred, abort the transaction</span>
  <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">abortTransaction</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Transaction aborted:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="c1">// End the session</span>
  <span class="nx">session</span><span class="p">.</span><span class="nf">endSession</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="considerations-for-transactions"><span class="me-2">Considerations for Transactions</span><a href="#considerations-for-transactions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><strong>Performance</strong>: Transactions may impact performance, especially for write-heavy workloads.</li>
  <li><strong>Timeout</strong>: Transactions have a default timeout of 60 seconds.</li>
  <li><strong>Replica Sets</strong>: Transactions require a replica set configuration.</li>
  <li><strong>Sharded Clusters</strong>: Transactions on sharded clusters have additional considerations and limitations.</li>
</ul>

<pre><code class="language-mermaid">graph TD
  subgraph transactionConsiderations["fa:fa-exclamation-triangle Transaction Considerations"]
    performance["fa:fa-tachometer-alt Performance Impact"]
    timeout["fa:fa-clock Timeout"]
    replicaSet["fa:fa-server Replica Set Required"]
    sharding["fa:fa-cubes Sharding Limitations"]
  end

  style transactionConsiderations stroke:#333,stroke-width:2px
  style performance fill:#fcc,stroke:#333,stroke-width:2px
  style timeout fill:#ffc,stroke:#333,stroke-width:2px
  style replicaSet fill:#cfc,stroke:#333,stroke-width:2px
  style sharding fill:#ccf,stroke:#333,stroke-width:2px
</code></pre>

<p>By using transactions, you can ensure data consistency and integrity across multiple operations in MongoDB, especially when dealing with complex data models or critical business logic.</p>

<h2 id="replica-sets"><span class="me-2">Replica Sets</span><a href="#replica-sets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>A replica set is a group of MongoDB instances that maintain the same data set. Replica sets provide redundancy and high availability.</p>

<h3 id="components-of-a-replica-set"><span class="me-2">Components of a Replica Set</span><a href="#components-of-a-replica-set" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><strong>Primary</strong>: Receives all write operations.</li>
  <li><strong>Secondary</strong>: Replicates data from the primary. Can be used for read operations.</li>
  <li><strong>Arbiter</strong>: Participates in elections for primary but does not hold data.</li>
</ul>

<pre><code class="language-mermaid">graph
  subgraph replicaSet["fa:fa-server Replica Set"]
    primary["fa:fa-database Primary"]
    secondary1["fa:fa-database Secondary"]
    secondary2["fa:fa-database Secondary"]
    arbiter["fa:fa-balance-scale Arbiter"]
  end

  primary --&gt; secondary1
  primary --&gt; secondary2
  primary --&gt; arbiter

  style replicaSet stroke:#333,stroke-width:2px
  style primary fill:#ccf,stroke:#f66,stroke-width:2px
  style secondary1 fill:#add8e6,stroke:#333,stroke-width:2px
  style secondary2 fill:#add8e6,stroke:#333,stroke-width:2px
  style arbiter fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="replica-set-configuration"><span class="me-2">Replica Set Configuration</span><a href="#replica-set-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To configure a replica set, you use the <code class="language-plaintext highlighter-rouge">rs.initiate()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nx">rs</span><span class="p">.</span><span class="nf">initiate</span><span class="p">({</span>
  <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rs0</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">members</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mongo1:27017</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mongo2:27017</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mongo3:27017</span><span class="dl">'</span><span class="p">,</span> <span class="na">arbiterOnly</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="read-preference"><span class="me-2">Read Preference</span><a href="#read-preference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Read preference in MongoDB determines how read operations are distributed across the replica set.</p>

<pre><code class="language-mermaid">graph LR
  subgraph readPreference["fa:fa-eye Read Preference"]
    primary["fa:fa-database Primary"]
    secondary["fa:fa-database Secondary"]
    primaryPreferred["fa:fa-database PrimaryPreferred"]
    secondaryPreferred["fa:fa-database SecondaryPreferred"]
    nearest["fa:fa-database Nearest"]
  end

  style readPreference stroke:#333,stroke-width:2px
  style primary fill:#ccf,stroke:#f66,stroke-width:2px
  style secondary fill:#add8e6,stroke:#333,stroke-width:2px
  style primaryPreferred fill:#9cf,stroke:#333,stroke-width:2px
  style secondaryPreferred fill:#9cf,stroke:#333,stroke-width:2px
  style nearest fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<ul>
  <li><strong>Primary</strong>: Reads from the primary.</li>
  <li><strong>Secondary</strong>: Reads from the secondary.</li>
  <li><strong>PrimaryPreferred</strong>: Reads from the primary if available, otherwise from the secondary.</li>
  <li><strong>SecondaryPreferred</strong>: Reads from the secondary if available, otherwise from the primary.</li>
  <li><strong>Nearest</strong>: Reads from the nearest member of the replica set.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nf">find</span><span class="p">().</span><span class="nf">readPref</span><span class="p">(</span><span class="dl">'</span><span class="s1">secondary</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="write-concern"><span class="me-2">Write Concern</span><a href="#write-concern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Write concern in MongoDB determines the level of acknowledgment for write operations.</p>

<pre><code class="language-mermaid">graph LR
  subgraph writeConcern["fa:fa-sync Write Concern"]
    w0["fa:fa-times w: 0"]
    w1["fa:fa-check w: 1"]
    wMajority["fa:fa-check w: majority"]
  end

  style writeConcern stroke:#333,stroke-width:2px
  style w0 fill:#ccf,stroke:#f66,stroke-width:2px
  style w1 fill:#add8e6,stroke:#333,stroke-width:2px
  style wMajority fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<ul>
  <li><strong>w: 0</strong>: No acknowledgment.</li>
  <li><strong>w: 1</strong>: Acknowledgment from the primary.</li>
  <li><strong>w: majority</strong>: Acknowledgment from the majority of the replica set.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>
<span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">).</span><span class="nx">insertOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">writeConcern</span><span class="p">:</span> <span class="p">{</span> <span class="na">w</span><span class="p">:</span> <span class="dl">'</span><span class="s1">major

</span></pre></td></tr></tbody></table></code></div></div>

<h3 id="automatic-failover"><span class="me-2">Automatic Failover</span><a href="#automatic-failover" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>MongoDB uses a heartbeat mechanism to detect the availability of replica set members. If the primary becomes unavailable, a new primary is elected.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Primary</code> is elected based on the number of votes from the replica set members.</li>
  <li><code class="language-plaintext highlighter-rouge">Secondary</code> can be promoted to primary if the primary is unavailable.</li>
  <li><code class="language-plaintext highlighter-rouge">Arbiter</code> is used to break the tie in elections.</li>
</ul>

<pre><code class="language-mermaid">graph
  subgraph failover["fa:fa-sync Failover"]
    primary["fa:fa-database Primary"]
    secondary1["fa:fa-database Secondary"]
    secondary2["fa:fa-database Secondary"]
    arbiter["fa:fa-balance-scale Arbiter"]
  end

  primary --&gt; secondary1
  primary --&gt; secondary2
  primary --&gt; arbiter

  style failover stroke:#333,stroke-width:2px
  style primary fill:#ccf,stroke:#f66,stroke-width:2px
  style secondary1 fill:#add8e6,stroke:#333,stroke-width:2px
  style secondary2 fill:#add8e6,stroke:#333,stroke-width:2px
  style arbiter fill:#9cf,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="manual-failover"><span class="me-2">Manual Failover</span><a href="#manual-failover" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>You can initiate a manual failover in MongoDB by forcing a replica set member to become the primary.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">rs</span><span class="p">.</span><span class="nf">stepDown</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="sharding"><span class="me-2">Sharding</span><a href="#sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Sharding is a method for distributing data across multiple machines. It allows you to scale horizontally by adding more machines to your system.</p>

<p>A Collection is divided into chunks, and each chunk is stored on a different shard.</p>

<p>Each Shard is a subset of the data in a sharded cluster.</p>

<pre><code class="language-mermaid">graph
  subgraph sharding["fa:fa-database Sharding"]
    collection["fa:fa-folder-open Collection"]
    chunk1["fa:fa-cube Chunk 1"]
    chunk2["fa:fa-cube Chunk 2"]
    chunk3["fa:fa-cube Chunk 3"]
  end

  collection --&gt; chunk1
  collection --&gt; chunk2
  collection --&gt; chunk3

  style sharding stroke:#333,stroke-width:2px
  style collection fill:#ccf,stroke:#f66,stroke-width:2px
  style chunk1 fill:#add8e6,stroke:#333,stroke-width:2px
  style chunk2 fill:#9cf,stroke:#333,stroke-width:2px
  style chunk3 fill:#faa,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="components-of-sharding"><span class="me-2">Components of Sharding</span><a href="#components-of-sharding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><strong>Shard</strong>: A subset of the data in a sharded cluster.</li>
  <li><strong>Config Server</strong>: Stores metadata and configuration settings for the cluster.</li>
  <li><strong>Query Router</strong>: Routes queries to the appropriate shard.</li>
</ul>

<pre><code class="language-mermaid">graph
  subgraph sharding["fa:fa-database Sharding"]
    shard1["fa:fa-database Shard 1"]
    shard2["fa:fa-database Shard 2"]
    shard3["fa:fa-database Shard 3"]
    configServer["fa:fa-cogs Config Server"]
    queryRouter["fa:fa-route Query Router"]
  end

  shard1 --&gt; configServer
  shard2 --&gt; configServer
  shard3 --&gt; configServer
  queryRouter --&gt; shard1
  queryRouter --&gt; shard2
  queryRouter --&gt; shard3

  style sharding stroke:#333,stroke-width:2px
  style shard1 fill:#ccf,stroke:#f66,stroke-width:2px
  style shard2 fill:#add8e6,stroke:#333,stroke-width:2px
  style shard3 fill:#9cf,stroke:#333,stroke-width:2px
  style configServer fill:#ccf,stroke:#f66,stroke-width:2px
  style queryRouter fill:#add8e6,stroke:#333,stroke-width:2px

</code></pre>

<h3 id="sharding-key"><span class="me-2">Sharding Key</span><a href="#sharding-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The sharding key is the field used to distribute data across the shards. It should be chosen carefully to ensure a balanced distribution of data.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hashed</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>When selecting a shard key, consider the following factors:</p>

<ul>
  <li><strong>Cardinality</strong>: The number of unique values in the shard key.</li>
  <li><strong>Write Scaling</strong>: The ability to distribute write operations across shards.</li>
  <li><strong>Query Isolation</strong>: The ability to target specific shards for read operations.</li>
</ul>

<h3 id="shard-key-strategies"><span class="me-2">Shard Key Strategies</span><a href="#shard-key-strategies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><strong>Hashed Sharding</strong>: Distributes data evenly across the shards using a hash function.</li>
  <li><strong>Range Sharding</strong>: Distributes data based on a range of values in the shard key.</li>
  <li><strong>Compound Sharding</strong>: Distributes data based on multiple fields in the shard key.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hashed</span><span class="dl">'</span> <span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">date</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">createIndex</span><span class="p">({</span> <span class="na">country</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">city</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="mongoose"><span class="me-2">Mongoose</span><a href="#mongoose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Mongoose is an Object Data Modeling (ODM) library for MongoDB and Node.js. It provides a schema-based solution to model your application data.</p>

<pre><code class="language-mermaid">
graph 
  subgraph mongoose["fa:fa-database Mongoose"]
    connect["fa:fa-plug Connect"]
    schema["fa:fa-file Schema"]
    model["fa:fa-cube Model"]
    insert["fa:fa-plus-circle Insert"]
    find["fa:fa-eye Find"]
    update["fa:fa-edit Update"]
    delete["fa:fa-trash Delete"]
  end

  connect --&gt; schema
  schema --&gt; model
  model --&gt; insert
  model --&gt; find
  model --&gt; update
  model --&gt; delete

  style mongoose stroke:#333,stroke-width:2px
  style connect fill:#ccf,stroke:#f66,stroke-width:2px
  style schema fill:#add8e6,stroke:#333,stroke-width:2px
  style model fill:#9cf,stroke:#333,stroke-width:2px
  style insert fill:#ccf,stroke:#f66,stroke-width:2px
  style find fill:#add8e6,stroke:#333,stroke-width:2px
  style update fill:#9cf,stroke:#333,stroke-width:2px
  style delete fill:#faa,stroke:#333,stroke-width:2px
</code></pre>

<h3 id="connecting-to-mongodb"><span class="me-2">Connecting to MongoDB</span><a href="#connecting-to-mongodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To connect to MongoDB using Mongoose, you use the <code class="language-plaintext highlighter-rouge">connect()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongoose</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb://localhost:27017/myapp</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">useNewUrlParser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="defining-a-schema"><span class="me-2">Defining a Schema</span><a href="#defining-a-schema" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A Mongoose schema defines the structure of the documents in a collection.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">userSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nc">Schema</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="nb">Number</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="creating-a-model"><span class="me-2">Creating a Model</span><a href="#creating-a-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A Mongoose model is a class that represents a collection in MongoDB.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="dl">'</span><span class="s1">User</span><span class="dl">'</span><span class="p">,</span> <span class="nx">userSchema</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="inserting-documents"><span class="me-2">Inserting Documents</span><a href="#inserting-documents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To insert a document into a collection, you create an instance of the model and call the <code class="language-plaintext highlighter-rouge">save()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">25</span> <span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="nf">save</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="querying-documents"><span class="me-2">Querying Documents</span><a href="#querying-documents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To query documents from a collection, you use the <code class="language-plaintext highlighter-rouge">find()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>With Projection:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="updating-documents"><span class="me-2">Updating Documents</span><a href="#updating-documents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To update documents in a collection, you use the <code class="language-plaintext highlighter-rouge">updateOne()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">26</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="deleting-documents"><span class="me-2">Deleting Documents</span><a href="#deleting-documents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To delete documents from a collection, you use the <code class="language-plaintext highlighter-rouge">deleteOne()</code> method.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="middleware"><span class="me-2">Middleware</span><a href="#middleware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose middleware are functions that are executed before or after certain operations.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nf">pre</span><span class="p">(</span><span class="dl">'</span><span class="s1">save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saving user...</span><span class="dl">'</span><span class="p">);</span>
  <span class="nf">next</span><span class="p">();</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="virtuals"><span class="me-2">Virtuals</span><a href="#virtuals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose virtuals are document properties that you can get and set but that do not get persisted to MongoDB.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>
<span class="nx">userSchema</span><span class="p">.</span><span class="nf">virtual</span><span class="p">(</span><span class="dl">'</span><span class="s1">fullName</span><span class="dl">'</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="plugins"><span class="me-2">Plugins</span><a href="#plugins" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose plugins are reusable pieces of schema middleware that can be added to any schema.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">timestampPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./plugins/timestamp</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">userSchema</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="nx">timestampPlugin</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="transactions-1"><span class="me-2">Transactions</span><a href="#transactions-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose transactions allow you to perform multiple operations on multiple documents in a single transaction.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">startSession</span><span class="p">();</span>
<span class="nx">session</span><span class="p">.</span><span class="nf">startTransaction</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">session</span> <span class="p">});</span>
  <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bob</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">session</span> <span class="p">});</span>

  <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">commitTransaction</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nf">abortTransaction</span><span class="p">();</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="nx">session</span><span class="p">.</span><span class="nf">endSession</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="aggregation-1"><span class="me-2">Aggregation</span><a href="#aggregation-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose provides a fluent API for building aggregation pipelines.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$match</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$name</span><span class="dl">'</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$age</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="indexes"><span class="me-2">Indexes</span><a href="#indexes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose allows you to define indexes on your schemas.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nf">index</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="population"><span class="me-2">Population</span><a href="#population" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose population allows you to reference documents in other collections.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">userSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nc">Schema</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">posts</span><span class="p">:</span> <span class="p">[{</span> <span class="na">type</span><span class="p">:</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="na">ref</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Post</span><span class="dl">'</span> <span class="p">}]</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="validation"><span class="me-2">Validation</span><a href="#validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Mongoose provides built-in validation for schema fields.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">userSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nc">Schema</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="patterns"><span class="me-2">Patterns</span><a href="#patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li><a href="/posts/bucket-pattern">Bucket Pattern</a></li>
  <li><a href="/posts/attribute-pattern">Attribute Pattern</a></li>
  <li><a href="/posts/outlier-pattern">Outlier Pattern</a></li>
  <li><a href="/posts/subset-pattern/">Subset Pattern</a></li>
</ul>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Pattern</th>
      <th>Description</th>
      <th>Use Case</th>
      <th>Advantages</th>
      <th>Disadvantages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Bucket Pattern</td>
      <td>Groups related documents into fixed-size â€œbucketsâ€ or arrays</td>
      <td>Time-series data, IoT sensor readings</td>
      <td>- Reduces number of documents<br />- Improves query performance for range scans</td>
      <td>- Complex to update individual items<br />- May lead to document growth</td>
    </tr>
    <tr>
      <td>Attribute Pattern</td>
      <td>Stores a set of fields with similar access patterns as an embedded document</td>
      <td>Products with varying attributes</td>
      <td>- Flexible schema<br />- Efficient querying of common attributes</td>
      <td>- More complex queries for specific attributes<br />- Potential for unused fields</td>
    </tr>
    <tr>
      <td>Outlier Pattern</td>
      <td>Stores common data in one collection and rare, oversized data in another</td>
      <td>Social media posts with varying engagement levels</td>
      <td>- Optimizes for common case performance<br />- Prevents document size issues</td>
      <td>- Requires two queries for outliers<br />- More complex application logic</td>
    </tr>
    <tr>
      <td>Subset Pattern</td>
      <td>Stores a subset of fields from a document in a separate collection</td>
      <td>User profiles with frequently accessed fields</td>
      <td>- Improves read performance for common queries<br />- Reduces working set size</td>
      <td>- Data duplication<br />- Requires keeping subsets in sync</td>
    </tr>
  </tbody>
</table></div>

<h2 id="qa"><span class="me-2">Q&amp;A</span><a href="#qa" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="what-is-exec-in-mongoose"><span class="me-2">What is .exec() in Mongoose?</span><a href="#what-is-exec-in-mongoose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">exec()</code> function in Mongoose is used to execute a query and return a promise. It allows you to chain query methods and then execute the query at the end.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">}).</span><span class="nf">exec</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<p>You can run the query without <code class="language-plaintext highlighter-rouge">exec()</code>, by callback or using async/await.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">users</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">users</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="what-is-the-difference-between-findone-and-find-in-mongoose"><span class="me-2">What is the difference between <code class="language-plaintext highlighter-rouge">findOne()</code> and <code class="language-plaintext highlighter-rouge">find()</code> in Mongoose?</span><a href="#what-is-the-difference-between-findone-and-find-in-mongoose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">find()</code>: Returns an array of all documents that match the query criteria.</li>
  <li><code class="language-plaintext highlighter-rouge">findOne()</code>: Returns the first document that matches the query criteria.</li>
</ul>

<h3 id="what-is-the-difference-between-modelcreate-and-new-modelsave-in-mongoose"><span class="me-2">What is the difference between Model.create() and new Model().save() in Mongoose?</span><a href="#what-is-the-difference-between-modelcreate-and-new-modelsave-in-mongoose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Model.create()</code>: Creates a new document and saves it to the database in a single step.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">new Model().save()</code>: reates a new instance of the model but doesnâ€™t save it to the database immediately. You can modify the instance, perform validations, or run any other operations before calling .save() to persist the changes.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Model</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">John</span><span class="dl">'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">30</span> <span class="p">});</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span> <span class="c1">// Modify the document</span>
<span class="k">await</span> <span class="nx">doc</span><span class="p">.</span><span class="nf">save</span><span class="p">();</span> <span class="c1">// Save the document after modification</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="what-is-the-purpose-of-the-lean-method-in-mongoose-queries-and-when-should-it-be-used"><span class="me-2">What is the purpose of the lean() method in Mongoose queries, and when should it be used?</span><a href="#what-is-the-purpose-of-the-lean-method-in-mongoose-queries-and-when-should-it-be-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">lean()</code> method in Mongoose queries returns plain JavaScript objects instead of Mongoose documents which come with a lot of additional features, such as getters, setters, and methods that are useful for working with the document . It should be used when you donâ€™t need the full Mongoose document features and want to improve query performance.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">User</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span> <span class="p">}).</span><span class="nf">lean</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="how-to-implement-soft-deletes-in-mongoose"><span class="me-2">How to implement soft deletes in Mongoose?</span><a href="#how-to-implement-soft-deletes-in-mongoose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Soft deletes in Mongoose involve marking documents as deleted instead of physically removing them from the database. You can achieve this by adding a <code class="language-plaintext highlighter-rouge">deleted</code> field to your schema and setting it to true when a document is deleted.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">userSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nc">Schema</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="na">deleted</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Use pre middleware to exclude deleted documents from query results.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nf">pre</span><span class="p">(</span><span class="sr">/^find/</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nf">where</span><span class="p">({</span> <span class="na">deleted</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
  <span class="nf">next</span><span class="p">();</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Add a method to â€œsoft deleteâ€ a document.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">softDelete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nf">save</span><span class="p">();</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/mern/">mern</a>,
          <a href="/categories/mongodb/">mongodb</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/mern/"
            class="post-tag no-text-decoration"
          >mern</a>
        
          <a
            href="/tags/mongodb/"
            class="post-tag no-text-decoration"
          >mongodb</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=MERN%20-%20MongoDB%20Fundamental%20-%20KelvinBz&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmongodb-fundamental%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=MERN%20-%20MongoDB%20Fundamental%20-%20KelvinBz&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmongodb-fundamental%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmongodb-fundamental%2F&text=MERN%20-%20MongoDB%20Fundamental%20-%20KelvinBz" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/password-hashing/">Hashing Passwords</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/expressjs-fundamental/">MERN - Express.js Fundamentals</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mongodb-fundamental/">MERN - MongoDB Fundamental</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/javascript-array-in-1-page/">JavaScript Array In 1 Page</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/blockchain-for-dummies/">Blockchain for dummies</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/database-design/">database design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mern/">mern</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/expressjs/">expressjs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/js/">js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/performance-optimization/">performance optimization</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/programming-quiz-hub/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1726876800"
  data-df="ll"
  
>
  Sep 21, 2024
</time>

              <h4 class="pt-0 my-2">It's Quiz Time! ðŸŽ¯</h4>
              <div class="text-muted">
                <p>Welcome to Programming Quiz Hub ðŸŽ¯
Boost your skills with interactive quizzes across programming and tech topics! Test your knowledge, explore new concepts, and track your progress with fun and enga...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/subset-pattern/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1722038400"
  data-df="ll"
  
>
  Jul 27, 2024
</time>

              <h4 class="pt-0 my-2">Subset Pattern: Optimizing MongoDB Working Sets</h4>
              <div class="text-muted">
                <p>Subset Pattern: Optimizing MongoDB Working Sets

Large documents with infrequently used data can cause working sets to exceed RAM, leading to performance issues.

The Subset Pattern addresses this ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/computed-pattern/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1721952000"
  data-df="ll"
  
>
  Jul 26, 2024
</time>

              <h4 class="pt-0 my-2">Computed Pattern - Efficiently Managing Data Computations</h4>
              <div class="text-muted">
                <p>Computed Pattern

The Computed Pattern involves precomputing values and storing the results to optimize performance and reduce CPU workload. This approach is particularly beneficial for application...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/expressjs-fundamental/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>MERN - Express.js Fundamentals</p>
    </a>
  

  
    <a
      href="/posts/programming-quiz-hub/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>It's Quiz Time! ðŸŽ¯</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <script src="/assets/mermaid.min.js"></script>
<script>
  document.querySelectorAll('.language-mermaid').forEach((block) => {
    block.style.display = 'none';
  });
  document.addEventListener('DOMContentLoaded', () => {
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    document.querySelectorAll('.language-mermaid').forEach((block) => {
      block.style.display = 'block';
    });
  });
</script>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/database-design/">database design</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mern/">mern</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/expressjs/">expressjs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/js/">js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/performance-optimization/">performance optimization</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script>






<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

